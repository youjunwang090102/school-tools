<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>é¦¬å¹´ç´…åŒ… - å¿«é€Ÿæ‰“åŒ…å·¥å…·</title>
    <style>
        body { font-family: 'Microsoft JhengHei', sans-serif; background: #222; color: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .box { border: 2px dashed #ffd700; padding: 50px; border-radius: 20px; background: #333; text-align: center; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        h1 { color: #ffd700; margin-bottom: 10px; }
        p { color: #ccc; margin-bottom: 30px; }
        button { padding: 20px 40px; font-size: 20px; cursor: pointer; background: #b30000; color: #fff; border: 2px solid #ffd700; border-radius: 10px; font-weight: bold; transition: 0.2s; }
        button:hover { transform: scale(1.05); background: #d00000; }
        #status { margin-top: 20px; color: #0f0; font-weight: bold; min-height: 24px; }
    </style>
</head>
<body>

    <div class="box">
        <h1>ğŸ§§ é¦¬å¹´ç´…åŒ… - æœ€çµ‚æ‰“åŒ…æ©Ÿ ğŸ§§</h1>
        <p>è«‹é¸å–ä½ çš„ã€Œ2000å…ƒåœ–ç‰‡ã€ï¼Œæˆ‘æœƒå¹«ä½ æŠŠåœ–ç‰‡å¯«å…¥ç¨‹å¼ç¢¼ä¸¦ç”¢ç”Ÿæª”æ¡ˆã€‚</p>
        
        <input type="file" id="upload" accept="image/*" style="display:none">
        <button onclick="document.getElementById('upload').click()">ğŸ“ é¸å–åœ–ç‰‡ä¸¦ä¸‹è¼‰ HTML</button>
        
        <div id="status"></div>
    </div>

    <textarea id="template" style="display:none">
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦¬å¹´ 3D ç™¼å¤§è²¡ - 168,000</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #1a0505; font-family: 'Microsoft JhengHei', sans-serif; }
        #ui-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: flex; flex-direction: column; justify-content: space-between; align-items: center; padding: 20px; box-sizing: border-box; }
        #title { color: #ffd700; font-size: 28px; text-shadow: 0 0 10px #ff0000; margin-top: 20px; font-weight: bold; }
        #counter-box { background: rgba(0, 0, 0, 0.7); padding: 15px 50px; border-radius: 50px; border: 2px solid #ffd700; margin-bottom: 50px; text-align: center; box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); }
        #money-label { color: #ccc; font-size: 14px; letter-spacing: 2px; }
        #total-amount { color: #00ff00; font-size: 56px; font-weight: bold; font-family: 'Courier New', monospace; }
        #instruction { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; background: rgba(0,0,0,0.6); padding: 12px 24px; border-radius: 30px; pointer-events: none; transition: opacity 0.5s; z-index: 5; font-size: 18px; border: 1px solid #fff; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <div id="ui-container">
        <div id="title">é¦¬å¹´è¡Œå¤§é‹ ğŸ’° æ­å–œç™¼è²¡</div>
        <div id="counter-box">
            <div id="money-label">ç›®å‰é‡‘é¡ (NTD)</div>
            <div id="total-amount">0</div>
        </div>
    </div>
    <div id="instruction">é»æ“Šç´…åŒ…æ‰“é–‹ ğŸ‘‡</div>
    <script>
        // === ä½ çš„åœ–ç‰‡è¢«å¯«åœ¨é€™è£¡ ===
        const EMBEDDED_IMAGE = "{{IMAGE_DATA}}";

        const TOTAL_AMOUNT = 168000;
        const BILL_VALUE = 2000;
        const TOTAL_BILLS = TOTAL_AMOUNT / BILL_VALUE;
        let currentMoney = 0;
        let isOpened = false;
        let billMaterial;

        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x1a0505, 0.02);
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 10, 20);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        scene.add(new THREE.AmbientLight(0xffffff, 0.7));
        const dirLight = new THREE.DirectionalLight(0xffd700, 0.8);
        dirLight.position.set(5, 10, 7);
        dirLight.castShadow = true;
        scene.add(dirLight);

        function createEnvelopeTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 512; canvas.height = 512;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#cc0000'; ctx.fillRect(0, 0, 512, 512);
            for(let i=0; i<1000; i++) { ctx.fillStyle = 'rgba(255, 215, 0, 0.2)'; ctx.fillRect(Math.random()*512, Math.random()*512, 2, 2); }
            ctx.font = 'bold 200px "Microsoft JhengHei"'; ctx.fillStyle = '#ffd700'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
            ctx.fillText('é¦¬', 256, 256);
            ctx.strokeStyle = '#ffd700'; ctx.lineWidth = 10; ctx.strokeRect(20, 20, 472, 472);
            return new THREE.CanvasTexture(canvas);
        }

        const envelopeGroup = new THREE.Group();
        scene.add(envelopeGroup);
        const envMat = new THREE.MeshStandardMaterial({ map: createEnvelopeTexture() });
        const envelopeBody = new THREE.Mesh(new THREE.BoxGeometry(4.2, 6, 0.25), envMat);
        envelopeBody.castShadow = true;
        envelopeGroup.add(envelopeBody);
        const flapGroup = new THREE.Group();
        flapGroup.position.set(0, 3, 0.125);
        envelopeGroup.add(flapGroup);
        const flap = new THREE.Mesh(new THREE.BoxGeometry(4.2, 1.5, 0.1), new THREE.MeshStandardMaterial({ color: 0xb30000 }));
        flap.position.set(0, -0.75, 0);
        flapGroup.add(flap);

        const bills = [];
        const billGeo = new THREE.PlaneGeometry(3.8, 1.9);
        billMaterial = new THREE.MeshStandardMaterial({ side: THREE.DoubleSide });

        // === åœ–ç‰‡è¼‰å…¥é‚è¼¯ ===
        if (EMBEDDED_IMAGE.length > 50) {
            const img = new Image();
            img.src = EMBEDDED_IMAGE;
            img.onload = function() {
                const tex = new THREE.Texture(img);
                tex.needsUpdate = true;
                billMaterial.map = tex;
                billMaterial.needsUpdate = true;
            };
        }

        for (let i = 0; i < TOTAL_BILLS; i++) {
            const bill = new THREE.Mesh(billGeo, billMaterial);
            bill.visible = false;
            envelopeGroup.add(bill);
            bills.push(bill);
        }

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        window.addEventListener('click', (event) => {
            if (isOpened) return;
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            if (raycaster.intersectObjects(envelopeGroup.children, true).length > 0) startAnimation();
        });

        function startAnimation() {
            isOpened = true;
            document.getElementById('instruction').style.opacity = 0;
            gsap.to(flapGroup.rotation, { x: -Math.PI + 0.5, duration: 1, ease: "back.out(1.7)" });
            bills.forEach((bill, index) => {
                bill.visible = true;
                const delay = 0.8 + (index * 0.08); 
                gsap.to(bill.position, { y: 4, z: 0.5, duration: 0.5, delay: delay, ease: "power1.out", onComplete: () => {
                    gsap.to(bill.position, { x: (Math.random()-0.5)*1.5, y: -6+(index*0.025), z: 8, duration: 0.8, ease: "bounce.out", onStart: updateCounter });
                    gsap.to(bill.rotation, { x: Math.PI/2, z: (Math.random()-0.5)*0.5, duration: 0.8, delay: delay });
                }});
            });
        }
        function updateCounter() {
            currentMoney += BILL_VALUE;
            document.getElementById('total-amount').innerText = currentMoney.toLocaleString();
            gsap.fromTo(document.getElementById('total-amount'), {scale: 1.3}, {scale: 1, duration: 0.1});
        }
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            if (!isOpened) { envelopeGroup.rotation.y += 0.005; envelopeGroup.position.y = Math.sin(Date.now() * 0.002) * 0.5; }
            renderer.render(scene, camera);
        }
        window.addEventListener('resize', () => { camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });
        animate();
    </script>
</body>
</html>
    </textarea>

    <script>
        document.getElementById('upload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            document.getElementById('status').innerText = "â³ è™•ç†ä¸­...";

            const reader = new FileReader();
            reader.onload = function(event) {
                const base64String = event.target.result;
                
                // è®€å–éš±è—çš„æ¨¡æ¿
                let template = document.getElementById('template').value;
                
                // æ›¿æ›åœ–ç‰‡ä½”ä½ç¬¦
                const finalHtml = template.replace('{{IMAGE_DATA}}', base64String);

                // ç”¢ç”Ÿä¸‹è¼‰
                const blob = new Blob([finalHtml], {type: 'text/html'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'Final_Game.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                document.getElementById('status').innerText = "âœ… æˆåŠŸï¼æª”æ¡ˆå·²ä¸‹è¼‰";
            };
            reader.readAsDataURL(file);
        });
    </script>
</body>
</html>
