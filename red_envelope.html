<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦¬å¹´ 3D ç™¼å¤§è²¡ - 168,000</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #1a0505; font-family: 'Microsoft JhengHei', sans-serif; }
        
        /* UI ä»‹é¢å±¤ */
        #ui-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* è®“æ»‘é¼ ç©¿é€å»æ§åˆ¶ 3D */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }

        #title {
            color: #ffd700;
            font-size: 24px;
            text-shadow: 0 0 10px #ff0000;
            margin-top: 20px;
        }

        #counter-box {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px 40px;
            border-radius: 50px;
            border: 2px solid #ffd700;
            margin-bottom: 50px;
            text-align: center;
        }

        #money-label { color: #aaa; font-size: 14px; }
        #total-amount {
            color: #00ff00; /* éˆ”ç¥¨ç¶  */
            font-size: 48px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        #instruction {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            background: rgba(0,0,0,0.5);
            padding: 10px 20px;
            border-radius: 8px;
            pointer-events: none;
            transition: opacity 0.5s;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>

    <div id="ui-container">
        <div id="title">é¦¬å¹´è¡Œå¤§é‹ ğŸ’° æ­å–œç™¼è²¡</div>
        <div id="counter-box">
            <div id="money-label">ç›®å‰é‡‘é¡ (NTD)</div>
            <div id="total-amount">0</div>
        </div>
    </div>
    
    <div id="instruction">é»æ“Šç´…åŒ…æ‰“é–‹ ğŸ‘‡</div>

    <script>
        // --- è®Šæ•¸è¨­å®š ---
        const TOTAL_AMOUNT = 168000;
        const BILL_VALUE = 2000;
        const TOTAL_BILLS = TOTAL_AMOUNT / BILL_VALUE; // 84å¼µ
        let currentMoney = 0;
        let isOpened = false;

        // --- 1. å ´æ™¯åˆå§‹åŒ– (Scene Setup) ---
        const scene = new THREE.Scene();
        // æ·»åŠ éœ§åŒ–æ•ˆæœè®“èƒŒæ™¯æ›´æœ‰æ·±åº¦
        scene.fog = new THREE.FogExp2(0x1a0505, 0.02);

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 10, 20); // ç›¸æ©Ÿä½ç½®
        
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true; // é–‹å•Ÿé™°å½±
        document.body.appendChild(renderer.domElement);

        // --- 2. ç‡ˆå…‰ (Lights) ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        const dirLight = new THREE.DirectionalLight(0xffd700, 0.8);
        dirLight.position.set(5, 10, 7);
        dirLight.castShadow = true;
        scene.add(dirLight);

        // --- 3. æè³ªç”Ÿæˆå‡½æ•¸ (ä½¿ç”¨ Canvas å‹•æ…‹ç¹ªåœ–) ---
        
        // ç”Ÿæˆç´…åŒ…æè³ª (ç´…è‰²å¸¶é‡‘é¦¬å­—)
        function createEnvelopeTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 512; canvas.height = 512;
            const ctx = canvas.getContext('2d');
            
            // ç´…åº•
            ctx.fillStyle = '#cc0000';
            ctx.fillRect(0, 0, 512, 512);
            
            // é‡‘è‰²é›œé»è³ªæ„Ÿ
            for(let i=0; i<1000; i++) {
                ctx.fillStyle = 'rgba(255, 215, 0, 0.2)';
                ctx.fillRect(Math.random()*512, Math.random()*512, 2, 2);
            }

            // é‡‘å­— "é¦¬"
            ctx.font = 'bold 200px "Microsoft JhengHei"';
            ctx.fillStyle = '#ffd700';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.shadowColor = "rgba(0,0,0,0.5)";
            ctx.shadowBlur = 10;
            ctx.fillText('é¦¬', 256, 256);
            
            // é‚Šæ¡†
            ctx.strokeStyle = '#ffd700';
            ctx.lineWidth = 10;
            ctx.strokeRect(20, 20, 472, 472);

            const tex = new THREE.CanvasTexture(canvas);
            return tex;
        }

        // ç”Ÿæˆéˆ”ç¥¨æè³ª (è—è‰² 2000å…ƒ)
        function createBillTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 256; canvas.height = 128;
            const ctx = canvas.getContext('2d');

            // éŠ€è‰²/è—è‰²åº•
            const gradient = ctx.createLinearGradient(0, 0, 256, 128);
            gradient.addColorStop(0, '#c0c0c0');
            gradient.addColorStop(0.5, '#aaccff');
            gradient.addColorStop(1, '#c0c0c0');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 256, 128);

            // æ–‡å­—
            ctx.fillStyle = '#224488';
            ctx.font = 'bold 40px Arial';
            ctx.fillText('2000', 140, 40);
            ctx.font = 'bold 20px Arial';
            ctx.fillText('CENTRAL BANK', 20, 110);
            
            // åœ“å½¢å…¨æ¯åœ–
            ctx.beginPath();
            ctx.arc(40, 50, 25, 0, 2 * Math.PI);
            ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
            ctx.fill();

            const tex = new THREE.CanvasTexture(canvas);
            return tex;
        }

        // --- 4. å»ºç«‹ç‰©é«” (Objects) ---

        const envelopeGroup = new THREE.Group();
        scene.add(envelopeGroup);

        // A. ç´…åŒ…è¢‹èº«
        const envGeo = new THREE.BoxGeometry(4, 6, 0.2);
        const envMat = new THREE.MeshStandardMaterial({ map: createEnvelopeTexture() });
        const envelopeBody = new THREE.Mesh(envGeo, envMat);
        envelopeBody.castShadow = true;
        envelopeGroup.add(envelopeBody);

        // B. ç´…åŒ…è“‹å­ (Pivot è¨­åœ¨é ‚éƒ¨)
        const flapGroup = new THREE.Group();
        flapGroup.position.set(0, 3, 0.1); // ç§»åˆ°è¢‹èº«é ‚éƒ¨
        envelopeGroup.add(flapGroup);

        const flapGeo = new THREE.BoxGeometry(4, 1.5, 0.1);
        const flapMat = new THREE.MeshStandardMaterial({ color: 0xb30000 }); // ç•¥æ·±çš„ç´…
        const flap = new THREE.Mesh(flapGeo, flapMat);
        flap.position.set(0, -0.75, 0); // èª¿æ•´å¹¾ä½•ä¸­å¿ƒï¼Œè®“æ—‹è½‰è»¸åœ¨é ‚éƒ¨
        flapGroup.add(flap);

        // C. å»ºç«‹éˆ”ç¥¨æ±  (éš±è—åœ¨ç´…åŒ…è£¡)
        const bills = [];
        const billGeo = new THREE.PlaneGeometry(3.6, 1.6);
        const billMat = new THREE.MeshStandardMaterial({ 
            map: createBillTexture(), 
            side: THREE.DoubleSide 
        });

        for (let i = 0; i < TOTAL_BILLS; i++) {
            const bill = new THREE.Mesh(billGeo, billMat);
            // åˆå§‹ä½ç½®è—åœ¨ç´…åŒ…å…§éƒ¨
            bill.position.set(0, 0, 0); 
            bill.visible = false; // ä¸€é–‹å§‹ä¸å¯è¦‹
            envelopeGroup.add(bill); // ç¶å®šåœ¨ç´…åŒ…ç¾¤çµ„ï¼Œè·Ÿè‘—æ—‹è½‰
            bills.push(bill);
        }

        // --- 5. äº’å‹•æ§åˆ¶ (Controls & Raycaster) ---
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;

        // é»æ“Šäº‹ä»¶
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        window.addEventListener('click', onMouseClick, false);

        function onMouseClick(event) {
            if (isOpened) return; // å·²ç¶“é–‹éå°±ä¸èƒ½å†é»

            // è¨ˆç®—æ»‘é¼ ä½ç½®
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(envelopeGroup.children, true);

            if (intersects.length > 0) {
                startAnimation();
            }
        }

        // --- 6. å‹•ç•«é‚è¼¯ (GSAP Animation) ---
        function startAnimation() {
            isOpened = true;
            document.getElementById('instruction').style.opacity = 0;

            // 1. æ‰“é–‹è“‹å­
            gsap.to(flapGroup.rotation, {
                x: -Math.PI + 0.5, // å¾€ä¸Šç¿»ï¼Œç¨å¾®è¶…é180åº¦
                duration: 1,
                ease: "back.out(1.7)"
            });

            // 2. éˆ”ç¥¨ä¾åºé£›å‡º
            bills.forEach((bill, index) => {
                bill.visible = true;
                
                // å°‡éˆ”ç¥¨å¾ç¾¤çµ„è½‰ç§»åˆ°ä¸–ç•Œåº§æ¨™ (é€™æ¨£å®ƒæ‰å‡ºä¾†å¾Œä¸æœƒè·Ÿè‘—ç´…åŒ…è½‰)
                // é€™è£¡ç°¡åŒ–è™•ç†ï¼šç›´æ¥ç”¨ä¸–ç•Œåº§æ¨™å‹•ç•«ï¼Œè¦–è¦ºä¸Šè„«é›¢
                
                // è¨­å®šå»¶é²ï¼šè¶Šå¾Œé¢çš„è¶Šæ™šå‡ºä¾†
                const delay = 0.8 + (index * 0.08); 

                // é£›å‡ºå‹•ç•«
                gsap.to(bill.position, {
                    y: 4, // å…ˆå¾€ä¸ŠæŠ½å‡ºä¾†
                    z: 0.5,
                    duration: 0.5,
                    delay: delay,
                    ease: "power1.out",
                    onComplete: () => {
                        // æŠ½å‡ºå¾Œï¼Œé£›å‘é¡é ­å‰æ–¹çš„å †ç–Šè™•
                        gsap.to(bill.position, {
                            x: (Math.random() - 0.5) * 1, // éš¨æ©Ÿç¨å¾®äº‚ä¸€é»
                            y: -6 + (index * 0.02),       // å †ç–Šé«˜åº¦å¢åŠ 
                            z: 8,                         // é è¿‘é¡é ­
                            duration: 0.8,
                            ease: "bounce.out",
                            onStart: () => {
                                // æ¯æ¬¡è½åœ°é–‹å§‹æ›´æ–°æ•¸å­—
                                updateCounter();
                            }
                        });

                        // è®“éˆ”ç¥¨æ‰ä¸‹ä¾†æ™‚ç¨å¾®æ—‹è½‰
                        gsap.to(bill.rotation, {
                            x: Math.PI / 2, // å¹³èºº
                            z: Math.random() * 0.5 - 0.25, // éš¨æ©Ÿæ­ªæ–œ
                            duration: 0.8,
                            delay: delay
                        });
                    }
                });
            });
        }

        // æ›´æ–° UI æ•¸å­—
        const totalAmountDiv = document.getElementById('total-amount');
        function updateCounter() {
            currentMoney += BILL_VALUE;
            // æ ¼å¼åŒ–æ•¸å­—åŠ é€—è™Ÿ
            totalAmountDiv.innerText = currentMoney.toLocaleString();
            
            // ç°¡å–®çš„æ–‡å­—è·³å‹•æ•ˆæœ
            gsap.fromTo(totalAmountDiv, {scale: 1.5}, {scale: 1, duration: 0.1});
        }

        // --- 7. æ¸²æŸ“è¿´åœˆ (Render Loop) ---
        function animate() {
            requestAnimationFrame(animate);
            controls.update(); // è®“æ…£æ€§æ—‹è½‰ç”Ÿæ•ˆ
            
            // å¦‚æœé‚„æ²’æ‰“é–‹ï¼Œè®“ç´…åŒ…è‡ªå·±ç¨å¾®æ‡¸æµ®æ—‹è½‰ï¼Œå¸å¼•æ³¨æ„
            if (!isOpened) {
                envelopeGroup.rotation.y += 0.005;
                envelopeGroup.position.y = Math.sin(Date.now() * 0.002) * 0.5;
            }

            renderer.render(scene, camera);
        }

        // RWD èª¿æ•´
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();

    </script>
</body>
</html>
