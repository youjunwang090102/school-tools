<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦¬å¹´ 3D ç™¼å¤§è²¡ - 2000å…ƒæ——è‰¦ç‰ˆ</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #1a0505; font-family: 'Microsoft JhengHei', sans-serif; }
        
        /* UI ä»‹é¢å±¤ */
        #ui-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            z-index: 10;
        }

        #title {
            color: #ffd700;
            font-size: 24px;
            text-shadow: 0 0 10px #ff0000;
            margin-top: 50px; /* é¿é–‹ä¸Šå‚³æŒ‰éˆ• */
        }

        #counter-box {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px 40px;
            border-radius: 50px;
            border: 2px solid #ffd700;
            margin-bottom: 50px;
            text-align: center;
        }

        #money-label { color: #aaa; font-size: 14px; }
        #total-amount {
            color: #00ff00;
            font-size: 48px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        #instruction {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            background: rgba(0,0,0,0.5);
            padding: 10px 20px;
            border-radius: 8px;
            pointer-events: none;
            transition: opacity 0.5s;
            z-index: 5;
        }

        /* ä¸Šå‚³æŒ‰éˆ•æ¨£å¼ */
        #upload-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            pointer-events: auto;
            background: #ffd700;
            color: #b30000;
            border: 2px solid #fff;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            transition: transform 0.2s;
            z-index: 20;
        }
        #upload-btn:hover { transform: scale(1.05); }
        #file-input { display: none; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>

    <button id="upload-btn" onclick="document.getElementById('file-input').click()">ğŸ“ è¼‰å…¥éˆ”ç¥¨åœ–ç‰‡</button>
    <input type="file" id="file-input" accept="image/*">

    <div id="ui-container">
        <div id="title">é¦¬å¹´è¡Œå¤§é‹ ğŸ’° æ­å–œç™¼è²¡</div>
        <div id="counter-box">
            <div id="money-label">ç›®å‰é‡‘é¡ (NTD)</div>
            <div id="total-amount">0</div>
        </div>
    </div>
    
    <div id="instruction">é»æ“Šç´…åŒ…æ‰“é–‹ ğŸ‘‡</div>

    <script>
        // --- è®Šæ•¸è¨­å®š ---
        const TOTAL_AMOUNT = 168000;
        const BILL_VALUE = 2000;
        const TOTAL_BILLS = TOTAL_AMOUNT / BILL_VALUE; // 84å¼µ
        let currentMoney = 0;
        let isOpened = false;

        // --- 1. å ´æ™¯åˆå§‹åŒ– ---
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x1a0505, 0.02);

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 10, 20);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // --- 2. ç‡ˆå…‰ ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambientLight);

        const dirLight = new THREE.DirectionalLight(0xffd700, 0.8);
        dirLight.position.set(5, 10, 7);
        dirLight.castShadow = true;
        scene.add(dirLight);

        // --- 3. æè³ªç”Ÿæˆ ---
        
        // ç´…åŒ…æè³ª
        function createEnvelopeTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 512; canvas.height = 512;
            const ctx = canvas.getContext('2d');
            
            ctx.fillStyle = '#cc0000';
            ctx.fillRect(0, 0, 512, 512);
            for(let i=0; i<1000; i++) {
                ctx.fillStyle = 'rgba(255, 215, 0, 0.2)';
                ctx.fillRect(Math.random()*512, Math.random()*512, 2, 2);
            }
            ctx.font = 'bold 200px "Microsoft JhengHei"';
            ctx.fillStyle = '#ffd700';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.shadowColor = "rgba(0,0,0,0.5)";
            ctx.shadowBlur = 10;
            ctx.fillText('é¦¬', 256, 256);
            ctx.strokeStyle = '#ffd700';
            ctx.lineWidth = 10;
            ctx.strokeRect(20, 20, 472, 472);

            return new THREE.CanvasTexture(canvas);
        }

        // é è¨­éˆ”ç¥¨æè³ª (ç´«è‰² 2000 é¢¨æ ¼)
        function createDefaultBillTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 512; canvas.height = 256;
            const ctx = canvas.getContext('2d');

            // ç´«è‰²æ¼¸å±¤åº•
            const gradient = ctx.createLinearGradient(0, 0, 512, 0);
            gradient.addColorStop(0, '#d8bfd8'); // æ·¡ç´«
            gradient.addColorStop(0.5, '#9370db'); // ä¸­ç´«
            gradient.addColorStop(1, '#d8bfd8');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 512, 256);

            // æ–‡å­—
            ctx.fillStyle = '#4b0082';
            ctx.font = 'bold 80px Arial';
            ctx.textAlign = 'right';
            ctx.fillText('2000', 480, 80);
            ctx.textAlign = 'left';
            ctx.fillText('è²³ä»Ÿåœ“', 30, 220);
            
            // è¡›æ˜Ÿå¤©ç·šç¤ºæ„åœ– (åœ“åœˆ)
            ctx.beginPath();
            ctx.arc(256, 128, 60, 0, 2 * Math.PI);
            ctx.strokeStyle = 'rgba(255,255,255,0.5)';
            ctx.lineWidth = 5;
            ctx.stroke();

            return new THREE.CanvasTexture(canvas);
        }

        // --- 4. å»ºç«‹ç‰©é«” ---

        const envelopeGroup = new THREE.Group();
        scene.add(envelopeGroup);

        // ç´…åŒ…è¢‹èº«
        const envGeo = new THREE.BoxGeometry(4.2, 6, 0.25);
        const envMat = new THREE.MeshStandardMaterial({ map: createEnvelopeTexture() });
        const envelopeBody = new THREE.Mesh(envGeo, envMat);
        envelopeBody.castShadow = true;
        envelopeGroup.add(envelopeBody);

        // ç´…åŒ…è“‹å­
        const flapGroup = new THREE.Group();
        flapGroup.position.set(0, 3, 0.125);
        envelopeGroup.add(flapGroup);

        const flapGeo = new THREE.BoxGeometry(4.2, 1.5, 0.1);
        const flapMat = new THREE.MeshStandardMaterial({ color: 0xb30000 });
        const flap = new THREE.Mesh(flapGeo, flapMat);
        flap.position.set(0, -0.75, 0);
        flapGroup.add(flap);

        // éˆ”ç¥¨æ± 
        const bills = [];
        const billGeo = new THREE.PlaneGeometry(3.8, 1.9); // é…åˆçœŸå¯¦éˆ”ç¥¨æ¯”ä¾‹
        // åˆå§‹æè³ªä½¿ç”¨é è¨­ç´«è‰²
        const billMat = new THREE.MeshStandardMaterial({ 
            map: createDefaultBillTexture(),
            side: THREE.DoubleSide,
            roughness: 0.4
        });

        for (let i = 0; i < TOTAL_BILLS; i++) {
            const bill = new THREE.Mesh(billGeo, billMat);
            bill.position.set(0, 0, 0); 
            bill.visible = false;
            envelopeGroup.add(bill);
            bills.push(bill);
        }

        // --- 5. åœ–ç‰‡ä¸Šå‚³è™•ç†é‚è¼¯ (é—œéµä¿®æ­£) ---
        const fileInput = document.getElementById('file-input');
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.src = event.target.result;
                img.onload = function() {
                    const texture = new THREE.Texture(img);
                    texture.needsUpdate = true;
                    
                    // æ›´æ–°æ‰€æœ‰éˆ”ç¥¨çš„è²¼åœ–
                    billMat.map = texture;
                    billMat.needsUpdate = true;
                    
                    // è®Šæ›´æŒ‰éˆ•æ–‡å­—æç¤ºæˆåŠŸ
                    document.getElementById('upload-btn').innerText = "âœ… åœ–ç‰‡å·²è¼‰å…¥ï¼";
                    setTimeout(() => document.getElementById('upload-btn').innerText = "ğŸ“ è¼‰å…¥éˆ”ç¥¨åœ–ç‰‡", 2000);
                };
            };
            reader.readAsDataURL(file);
        });

        // --- 6. äº’å‹•èˆ‡å‹•ç•« ---
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        window.addEventListener('click', onMouseClick, false);

        function onMouseClick(event) {
            // å¦‚æœé»æ“Šçš„æ˜¯ UI æŒ‰éˆ•ï¼Œä¸è§¸ç™¼é–‹ç´…åŒ…
            if (event.target.id === 'upload-btn') return;

            if (isOpened) return;

            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(envelopeGroup.children, true);

            if (intersects.length > 0) {
                startAnimation();
            }
        }

        function startAnimation() {
            isOpened = true;
            document.getElementById('instruction').style.opacity = 0;

            gsap.to(flapGroup.rotation, {
                x: -Math.PI + 0.5,
                duration: 1,
                ease: "back.out(1.7)"
            });

            bills.forEach((bill, index) => {
                bill.visible = true;
                const delay = 0.8 + (index * 0.08); 

                gsap.to(bill.position, {
                    y: 4, z: 0.5,
                    duration: 0.5, delay: delay, ease: "power1.out",
                    onComplete: () => {
                        // ä¸–ç•Œåº§æ¨™è½‰æ›æ¨¡æ“¬ï¼šè„«é›¢ç´…åŒ…
                        // é€™è£¡ç”¨ç°¡å–®çš„ä½ç§»æ¨¡æ“¬
                        gsap.to(bill.position, {
                            x: (Math.random() - 0.5) * 1.5,
                            y: -6 + (index * 0.025),
                            z: 8,
                            duration: 0.8,
                            ease: "bounce.out",
                            onStart: updateCounter
                        });
                        gsap.to(bill.rotation, {
                            x: Math.PI / 2,
                            z: Math.random() * 0.5 - 0.25,
                            duration: 0.8, delay: delay
                        });
                    }
                });
            });
        }

        const totalAmountDiv = document.getElementById('total-amount');
        function updateCounter() {
            currentMoney += BILL_VALUE;
            totalAmountDiv.innerText = currentMoney.toLocaleString();
            gsap.fromTo(totalAmountDiv, {scale: 1.3}, {scale: 1, duration: 0.1});
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            if (!isOpened) {
                envelopeGroup.rotation.y += 0.005;
                envelopeGroup.position.y = Math.sin(Date.now() * 0.002) * 0.5;
            }
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();

    </script>
</body>
</html>
