<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç­ç´šæ•¸ä½å¹³å°</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ç­ç´šå¹³å°">
    
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore-compat.js"></script>
    
    <style>
        /* --- å®Œå…¨ä¿ç•™åŸå§‹ :root è®Šæ•¸ --- */
        :root {
            --p: #4361ee; --s: #2ec4b6; --a: #ff9f1c; --t: #ef233c; --g: #7209b7; 
            --m: #ffd60a; --v: #38b000; --cal: #5856D6; --whi: #AF52DE; 
            --help: #ff758c; --duty: #4cc9f0; --hw: #f72585; --pdf: #3a0ca3;
            --bg: #f0f2f5; --card: #ffffff; --text: #2b2d42;
        }

        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Microsoft JhengHei", sans-serif; background-color: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; min-height: 100vh; }

        /* é ‚éƒ¨æŒ‰éˆ•åˆ— */
        .auth-bar { width: 100%; max-width: 500px; padding: 10px 20px; box-sizing: border-box; display: flex; justify-content: flex-end; gap: 8px; align-items: center; }
        .auth-btn { font-size: 0.75rem; padding: 5px 12px; border-radius: 15px; border: 1px solid #ddd; background: white; cursor: pointer; color: #666; font-weight: bold; }
        .auth-btn.primary { background: var(--p); color: white; border: none; }
        .admin-gear { background: var(--t); color: white; border: none; display: none; }

        /* --- å®Œå…¨ä¿ç•™åŸå§‹ header --- */
        .header { width: 100%; padding: 50px 20px 30px; background: white; box-sizing: border-box; border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); text-align: center; }
        .header h1 { margin: 0; font-size: 1.8rem; font-weight: 800; color: var(--text); cursor: pointer; user-select: none; }
        .header p { margin: 8px 0 0; font-size: 0.9rem; color: #8d99ae; }

        /* --- å®Œå…¨ä¿ç•™åŸå§‹åˆ—è¡¨èˆ‡å¡ç‰‡ --- */
        .menu-list { width: 100%; max-width: 500px; padding: 20px; box-sizing: border-box; display: flex; flex-direction: column; gap: 14px; }
        .category-label { margin: 15px 0 5px 10px; font-size: 0.85rem; color: #8d99ae; font-weight: bold; letter-spacing: 1px; }
        .menu-item { background: var(--card); border-radius: 20px; padding: 18px; display: flex; align-items: center; text-decoration: none; color: inherit; box-shadow: 0 4px 6px rgba(0,0,0,0.02); transition: transform 0.2s, box-shadow 0.2s; border: 1px solid rgba(0,0,0,0.03); -webkit-tap-highlight-color: transparent; cursor: pointer; }
        .menu-item:active { transform: scale(0.97); background-color: #f8f9fa; }
        .icon-box { width: 52px; height: 52px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-right: 16px; flex-shrink: 0; }
        .info { flex-grow: 1; }
        .info h2 { margin: 0; font-size: 1.05rem; font-weight: 700; margin-bottom: 2px; }
        .info p { margin: 0; font-size: 0.82rem; color: #6d7280; line-height: 1.4; }
        .arrow { color: #ced4da; font-size: 1rem; margin-left: 10px; }

        /* é‚Šæ¡†å®šç¾© (å«æ–°å¢åŠŸèƒ½) */
        .calendar { border-left: 6px solid var(--cal); } .calendar .icon-box { background: #f0f0ff; color: var(--cal); }
        .timer { border-left: 6px solid var(--t); } .timer .icon-box { background: #ffe5e5; color: var(--t); }
        .teacher-help { border-left: 6px solid var(--help); } .teacher-help .icon-box { background: #fff0f2; color: var(--help); }
        .whisper { border-left: 6px solid var(--whi); } .whisper .icon-box { background: #f9f0ff; color: var(--whi); }
        .board { border-left: 6px solid var(--m); } .board .icon-box { background: #fffde7; color: #f59e0b; }
        .duty { border-left: 6px solid var(--duty); } .duty .icon-box { background: #e0f7fa; color: var(--duty); }
        .seat { border-left: 6px solid var(--p); } .seat .icon-box { background: #eef2ff; color: var(--p); }
        .vote { border-left: 6px solid var(--v); } .vote .icon-box { background: #e8f5e9; color: var(--v); }
        .group { border-left: 6px solid var(--g); } .group .icon-box { background: #f3e5f5; color: var(--g); }
        .exam { border-left: 6px solid var(--s); } .exam .icon-box { background: #e6fffa; color: var(--s); }
        .final { border-left: 6px solid var(--a); } .final .icon-box { background: #fffaf0; color: var(--a); }
        .homework { border-left: 6px solid var(--hw); } .homework .icon-box { background: #ffe4f0; color: var(--hw); }
        .pdf-tool { border-left: 6px solid var(--pdf); } .pdf-tool .icon-box { background: #e0d7ff; color: var(--pdf); }

        /* å½ˆçª—æ¨£å¼ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 25px; border-radius: 20px; width: 85%; max-width: 340px; text-align: center; }
        .modal-content input, .modal-content select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 12px; box-sizing: border-box; font-size: 16px; }
        .modal-content button { width: 100%; padding: 12px; background: var(--p); color: white; border: none; border-radius: 12px; margin-top: 10px; cursor: pointer; font-weight: bold; }

        footer { margin: 40px 0 20px; padding: 20px; font-size: 0.75rem; color: #adb5bd; text-align: center; line-height: 1.6; }
    </style>
</head>
<body>

    <div class="auth-bar">
        <span id="uDisplayName" style="font-size: 0.75rem; color: #8d99ae; margin-right: auto; padding-left: 10px;"></span>
        <button id="adminBtn" class="auth-btn admin-gear" onclick="openModal('mngModal')">âš™ï¸ ç®¡ç†</button>
        <button id="lgnBtn" class="auth-btn primary" onclick="openModal('lgnModal')">ç™»å…¥</button>
        <button id="rgtBtn" class="auth-btn" onclick="openModal('rgtModal')">è¨»å†Š</button>
        <button id="outBtn" class="auth-btn" style="display:none;" onclick="logout()">ç™»å‡º</button>
    </div>

    <div class="header">
        <h1>ç­ç´šæ•¸ä½å¹³å°</h1>
        <p>æ•´åˆç­ç´šå¸¸ç”¨æœå‹™ ï½œ å°å¸«æ•™å­¸åˆ©å™¨ï¼†å­¸ç”Ÿå­¸ç¿’åŠ©æ‰‹</p>
    </div>

    <div class="menu-list">
        <div class="category-label">ğŸ”” æé†’ç³»åˆ—</div>
        <a href="countdown/index.html" class="menu-item timer">
            <div class="icon-box">â³</div>
            <div class="info"><h2>å¤§è€ƒèˆ‡æ—¥ç¨‹å€’æ•¸</h2><p>æŒæ¡çµ±æ¸¬ã€å­¸æ¸¬å€’æ•¸æ™‚é–“ (å…ç™»å…¥)</p></div>
            <div class="arrow">â¯</div>
        </a>
        <div class="menu-item calendar" onclick="go('è¡Œäº‹æ›†/index.html')">
            <div class="icon-box">ğŸ“…</div>
            <div class="info"><h2>ç­ç´šé‡è¦è¡Œäº‹æ›†</h2><p>è€ƒè©¦ã€æ´»å‹•ã€è£œèª²æ—¥ç¨‹ä¸æ¼æ¥</p></div>
            <div class="arrow">â¯</div>
        </div>

        <div class="category-label">ğŸ“š å­¸æ¥­èˆ‡å·¥å…·</div>
        <div class="menu-item homework" onclick="go('homework/index.html')">
            <div class="icon-box">âœï¸</div>
            <div class="info"><h2>å„ç§‘ä½œæ¥­æé†’</h2><p>ç”±å°è€å¸«æ›´æ–°å„ç§‘ä½œæ¥­é€²åº¦</p></div>
            <div class="arrow">â¯</div>
        </div>
        <div class="menu-item pdf-tool" onclick="go('pdf_tools/index.html')">
            <div class="icon-box">ğŸ“</div>
            <div class="info"><h2>å­¸ç¿’æ­·ç¨‹æª”æ¡ˆå£“ç¸®</h2><p>è‡ªå‹•ç¬¦åˆæª”æ¡ˆä¸Šå‚³å¤§å°é™åˆ¶</p></div>
            <div class="arrow">â¯</div>
        </div>

        <div class="category-label">ğŸ¤ äº’å‹•ç³»åˆ—</div>
        <div class="menu-item teacher-help" onclick="go('help/student.html')"><div class="icon-box">ğŸŒ±</div><div class="info"><h2>å°å¸«æ‚„æ‚„è©± (å¿ƒè²ç®±)</h2><p>é‡åˆ°å›°é›£äº†å—ï¼Ÿé»é€™è£¡ç§ä¸‹å‘Šè¨´è€å¸«</p></div><div class="arrow">â¯</div></div>
        <div class="menu-item whisper" onclick="go('åŒ¿å/index.html')"><div class="icon-box">ğŸ¤«</div><div class="info"><h2>ç­ç´šåŒ¿åè¨±é¡˜æ± </h2><p>æœ‰ä»€éº¼æƒ³èªªçš„ï¼Ÿæ‚„æ‚„å‘Šè¨´å¤§å®¶</p></div><div class="arrow">â¯</div></div>
        <div class="menu-item board" onclick="go('board/index.html')"><div class="icon-box">ğŸ’¬</div><div class="info"><h2>ç­ç´šäº’å‹•ç•™è¨€æ¿</h2><p>ç­ç´šäº‹å‹™å…¬é–‹è¨è«–å€</p></div><div class="arrow">â¯</div></div>

        <div class="category-label">âš™ï¸ ç­å‹™è™•ç†</div>
        <div class="menu-item duty" onclick="go('cleaning/index.html')"><div class="icon-box">ğŸ§¹</div><div class="info"><h2>ç­ç´šå‹¤å‹™ç®¡ç†ç³»çµ±</h2><p>å…§å¤–è¡›ç”Ÿæª¢æŸ¥èˆ‡è¨˜é»çæ‡²çµ±è¨ˆ</p></div><div class="arrow">â¯</div></div>
        <div class="menu-item seat" onclick="go('seating/index.html')"><div class="icon-box">ğŸª‘</div><div class="info"><h2>æ•¸ä½æ•™å®¤é¸ä½ç³»çµ±</h2><p>ç¾å ´è¶…åˆºæ¿€æŠ½ç±¤é¸ä½</p></div><div class="arrow">â¯</div></div>
        <div class="menu-item vote" onclick="go('vote/index.html')"><div class="icon-box">ğŸ—³ï¸</div><div class="info"><h2>ç·šä¸ŠæŠ•ç¥¨æ±ºç­–ç³»çµ±</h2><p>é‡è¦ç­ç´šäº‹å‹™ä¸€éµè¡¨æ±º</p></div><div class="arrow">â¯</div></div>
        <div class="menu-item group" onclick="go('grouping/index.html')"><div class="icon-box">ğŸ²</div><div class="info"><h2>éš¨æ©Ÿåˆ†çµ„å°å¹«æ‰‹</h2><p>è¼¸å…¥åå–®è‡ªå‹•å…¬å¹³åˆ†çµ„</p></div><div class="arrow">â¯</div></div>

        <div class="category-label">ğŸ“Š æˆç¸¾ç³»åˆ—</div>
        <div class="menu-item exam" onclick="go('exam_calc/index.html')"><div class="icon-box">ğŸ“</div><div class="info"><h2>æ®µè€ƒæˆç¸¾åŠ æ¬Šè¨ˆç®—</h2><p>è¨ˆç®—æ®µè€ƒåŠ æ¬Šå¹³å‡åˆ†æ•¸</p></div><div class="arrow">â¯</div></div>
        <div class="menu-item final" onclick="go('final_calc/index.html')"><div class="icon-box">ğŸ“ˆ</div><div class="info"><h2>ç§‘ç›®å­¸æœŸç¸½æˆç¸¾</h2><p>è¨ˆç®—å¹³æ™‚ã€æ®µè€ƒèˆ‡æœŸæœ«åŠ æ¬Š</p></div><div class="arrow">â¯</div></div>
    </div>

    <div id="lgnModal" class="modal"><div class="modal-content"><h3>å­¸ç”Ÿç™»å…¥</h3><input type="number" id="sId" placeholder="åº§è™Ÿ (å¦‚ 05)"><input type="password" id="sPw" placeholder="å¯†ç¢¼"><button onclick="login()">ç™»å…¥ç³»çµ±</button><button onclick="closeModal('lgnModal')" style="background:#eee; color:#333;">å–æ¶ˆ</button></div></div>
    
    <div id="rgtModal" class="modal"><div class="modal-content"><h3>å¸³è™Ÿè¨»å†Š</h3><input type="number" id="rId" placeholder="åº§è™Ÿ"><input type="text" id="rNm" placeholder="å§“å"><input type="password" id="rPw" placeholder="å¯†ç¢¼"><button onclick="register()">å®Œæˆè¨»å†Š</button><button onclick="closeModal('rgtModal')" style="background:#eee; color:#333;">å–æ¶ˆ</button></div></div>
    
    <div id="mngModal" class="modal"><div class="modal-content" style="max-width: 400px; width:90%;"><h3>âš™ï¸ ä½œæ¥­æŒ‡æ´¾èˆ‡ç®¡ç†</h3><div id="stuList" style="max-height:350px; overflow-y:auto; text-align:left;"></div><button onclick="closeModal('mngModal')" style="background:#666">é—œé–‰å¾Œå°</button></div></div>

    <footer>Â© 2026 ç­ç´šæ•¸ä½æœå‹™ç³»çµ±<br>Designed by ç‹å®¥éˆ</footer>

    <script>
        // Firebase é…ç½® (è«‹ä¿æŒæ‚¨çš„è³‡è¨Š)
        const firebaseConfig = { 
            apiKey: "AIzaSyCJavnjgSkyTzhoT5g9Retmyg005-gbld0",
            authDomain: "vote-6668.firebaseapp.com",
            projectId: "vote-6668",
            storageBucket: "vote-6668.firebasestorage.app",
            messagingSenderId: "389284021944",
            appId: "1:389284021944:web:3c5311697cbfc7c010564d"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // é é¢è·³è½‰é‚è¼¯
        function go(url) {
            if (sessionStorage.getItem('user')) {
                window.location.assign(url); // ä½¿ç”¨ assign ç¶­æŒ iOS ç¨ç«‹æ¨¡å¼
            } else {
                alert("ğŸ”’ æ­¤åŠŸèƒ½éœ€è¦ç™»å…¥ï¼Œè«‹å…ˆç™»å…¥å¸³è™Ÿã€‚");
                openModal('lgnModal');
            }
        }

        function openModal(id) { document.getElementById(id).style.display = 'flex'; if(id==='mngModal') loadManage(); }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        async function login() {
            const sid = document.getElementById('sId').value.padStart(2, '0');
            const spw = document.getElementById('sPw').value;
            const doc = await db.collection("students").doc(sid).get();
            if (doc.exists && doc.data().password === spw) {
                sessionStorage.setItem('user', JSON.stringify({id: sid, ...doc.data()}));
                location.reload();
            } else { alert("åº§è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼"); }
        }

        async function register() {
            const rid = document.getElementById('rId').value.padStart(2, '0');
            const rnm = document.getElementById('rNm').value;
            const rpw = document.getElementById('rPw').value;
            if(!rid || !rnm || !rpw) return alert("è«‹å¡«å¯«å®Œæ•´è¨»å†Šå…§å®¹");
            await db.collection("students").doc(rid).set({ name: rnm, password: rpw, role: "student", subject_role: "ç„¡" });
            alert("è¨»å†ŠæˆåŠŸï¼è«‹ç™»å…¥");
            closeModal('rgtModal');
        }

        function updateUI() {
            const user = JSON.parse(sessionStorage.getItem('user'));
            if (user) {
                document.getElementById('uDisplayName').innerText = `åº§è™Ÿ ${user.id}ï¼š${user.name}`;
                document.getElementById('lgnBtn').style.display = 'none';
                document.getElementById('rgtBtn').style.display = 'none';
                document.getElementById('outBtn').style.display = 'block';
                if (user.role === 'teacher' || user.role === 'admin') {
                    document.getElementById('adminBtn').style.display = 'block';
                }
            }
        }

        function loadManage() {
            db.collection("students").orderBy(firebase.firestore.FieldPath.documentId()).onSnapshot(snap => {
                const box = document.getElementById('stuList');
                box.innerHTML = "";
                snap.forEach(doc => {
                    const d = doc.data();
                    box.innerHTML += `<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px; font-size:0.85rem;">
                        <span><b>${doc.id}</b> ${d.name}</span>
                        <div style="display:flex; gap:5px;">
                            <select onchange="updateSubRole('${doc.id}', this.value)" style="font-size:0.75rem; border-radius:5px;">
                                <option value="ç„¡" ${d.subject_role==='ç„¡'?'selected':''}>ä¸€èˆ¬</option>
                                <option value="åœ‹æ–‡" ${d.subject_role==='åœ‹æ–‡'?'selected':''}>åœ‹æ–‡</option>
                                <option value="è‹±æ–‡" ${d.subject_role==='è‹±æ–‡'?'selected':''}>è‹±æ–‡</option>
                                <option value="æ•¸å­¸" ${d.subject_role==='æ•¸å­¸'?'selected':''}>æ•¸å­¸</option>
                                <option value="åŒ–å­¸" ${d.subject_role==='åŒ–å­¸'?'selected':''}>åŒ–å­¸</option>
                                <option value="ç‰©ç†" ${d.subject_role==='ç‰©ç†'?'selected':''}>ç‰©ç†</option>
                            </select>
                            <button onclick="delAccount('${doc.id}')" style="background:#ff4d4d; color:white; border:none; border-radius:5px; padding:2px 6px;">åˆª</button>
                        </div>
                    </div>`;
                });
            });
        }

        async function updateSubRole(sid, srole) { await db.collection("students").doc(sid).update({ subject_role: srole }); }
        async function delAccount(sid) { if(confirm("ç¢ºå®šæ°¸ä¹…ç§»é™¤æ­¤å¸³è™Ÿï¼Ÿ")) await db.collection("students").doc(sid).delete(); }
        function logout() { sessionStorage.clear(); location.reload(); }

        window.onload = updateUI;
    </script>
</body>
</html>
