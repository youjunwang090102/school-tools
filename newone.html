<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç­ç´šæ•¸ä½å¹³å° | æ•´åˆä¸­å¿ƒ</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore-compat.js"></script>
    
    <style>
        /* ä¿ç•™æ‚¨åŸæœ¬çš„æ‰€æœ‰é¡è‰²å®šç¾© */
        :root {
            --p: #4361ee; --s: #2ec4b6; --a: #ff9f1c; --t: #ef233c; --g: #7209b7; 
            --m: #ffd60a; --v: #38b000; --cal: #5856D6; --whi: #AF52DE; 
            --help: #ff758c; --duty: #4cc9f0; --hw: #f72585; --pdf: #3a0ca3;
            --bg: #f0f2f5; --card: #ffffff; --text: #2b2d42;
        }

        body {
            margin: 0; padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft JhengHei", sans-serif;
            background-color: var(--bg); color: var(--text);
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }

        /* ç™»å…¥ç‰†æ¨£å¼ */
        .auth-container { width: 100%; max-width: 400px; margin-top: 80px; padding: 20px; box-sizing: border-box; }
        .auth-card { background: white; padding: 30px; border-radius: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; }
        .auth-card input, .auth-card button, .auth-card select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 12px; border: 1px solid #ddd; font-size: 16px; box-sizing: border-box; }
        .auth-card button { background: var(--p); color: white; border: none; font-weight: bold; cursor: pointer; }

        /* æ¨™é¡Œèˆ‡åˆ—è¡¨æ¨£å¼ (å®Œå…¨æ²¿ç”¨æ‚¨çš„è¨­è¨ˆ) */
        .header { width: 100%; padding: 50px 20px 30px; background: white; text-align: center; border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .menu-list { width: 100%; max-width: 500px; padding: 20px; box-sizing: border-box; display: flex; flex-direction: column; gap: 14px; }
        .category-label { margin: 15px 0 5px 10px; font-size: 0.85rem; color: #8d99ae; font-weight: bold; }
        .menu-item { background: var(--card); border-radius: 20px; padding: 18px; display: flex; align-items: center; text-decoration: none; color: inherit; box-shadow: 0 4px 6px rgba(0,0,0,0.02); transition: 0.2s; border: 1px solid rgba(0,0,0,0.03); }
        .icon-box { width: 52px; height: 52px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-right: 16px; flex-shrink: 0; }
        .info h2 { margin: 0; font-size: 1.05rem; font-weight: 700; }
        .info p { margin: 0; font-size: 0.82rem; color: #6d7280; }

        /* æ‰€æœ‰çš„é‚Šæ¡†é¡è‰²å®šç¾© */
        .calendar { border-left: 6px solid var(--cal); } .calendar .icon-box { background: #f0f0ff; color: var(--cal); }
        .timer { border-left: 6px solid var(--t); } .timer .icon-box { background: #ffe5e5; color: var(--t); }
        .teacher-help { border-left: 6px solid var(--help); } .teacher-help .icon-box { background: #fff0f2; color: var(--help); }
        .whisper { border-left: 6px solid var(--whi); } .whisper .icon-box { background: #f9f0ff; color: var(--whi); }
        .board { border-left: 6px solid var(--m); } .board .icon-box { background: #fffde7; color: #f59e0b; }
        .duty { border-left: 6px solid var(--duty); } .duty .icon-box { background: #e0f7fa; color: var(--duty); }
        .seat { border-left: 6px solid var(--p); } .seat .icon-box { background: #eef2ff; color: var(--p); }
        .vote { border-left: 6px solid var(--v); } .vote .icon-box { background: #e8f5e9; color: var(--v); }
        .group { border-left: 6px solid var(--g); } .group .icon-box { background: #f3e5f5; color: var(--g); }
        .exam { border-left: 6px solid var(--s); } .exam .icon-box { background: #e6fffa; color: var(--s); }
        .final { border-left: 6px solid var(--a); } .final .icon-box { background: #fffaf0; color: var(--a); }
        /* æ–°å¢åŠŸèƒ½é¡è‰² */
        .homework { border-left: 6px solid var(--hw); } .homework .icon-box { background: #ffe4f0; color: var(--hw); }
        .pdf-tool { border-left: 6px solid var(--pdf); } .pdf-tool .icon-box { background: #e0d7ff; color: var(--pdf); }

        /* ç®¡ç†å“¡æ¨£å¼ */
        .admin-panel { width: 100%; max-width: 500px; padding: 10px; display: none; }
        .stu-row { background: white; padding: 10px; border-radius: 12px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #eee; }
    </style>
</head>
<body>

    <div id="authContainer" class="auth-container">
        <div class="auth-card">
            <h2 id="authTitle" style="color:var(--p)">ç­ç´šé›²ç«¯æœå‹™</h2>
            <div id="loginForm">
                <input type="number" id="stuId" placeholder="åº§è™Ÿ (ä¾‹å¦‚ 05)">
                <input type="password" id="stuPw" placeholder="å¯†ç¢¼">
                <button onclick="doLogin()">ç™»å…¥</button>
                <p style="font-size:0.8rem; color:#888; cursor:pointer;" onclick="toggleAuth(true)">å°šæœªè¨»å†Šå¸³è™Ÿï¼ŸæŒ‰æ­¤å»ºç«‹</p>
            </div>
            <div id="regForm" style="display:none;">
                <input type="number" id="regId" placeholder="åº§è™Ÿ">
                <input type="text" id="regName" placeholder="å§“å">
                <input type="password" id="regPw" placeholder="é è¨­å¯†ç¢¼">
                <select id="regRole">
                    <option value="student">å­¸ç”Ÿèº«åˆ†</option>
                    <option value="teacher">å°å¸«/ç®¡ç†å“¡</option>
                </select>
                <button onclick="doRegister()" style="background:var(--s)">å»ºç«‹å¸³è™Ÿ</button>
                <p style="font-size:0.8rem; color:#888; cursor:pointer;" onclick="toggleAuth(false)">è¿”å›ç™»å…¥</p>
            </div>
        </div>
    </div>

    <div id="mainContent" style="width:100%; display:none;">
        <div class="header">
            <h1 id="helloTitle">ç­ç´šæ•¸ä½å¹³å°</h1>
            <p id="roleTitle">èº«åˆ†ç¢ºèªä¸­...</p>
            <button onclick="logout()" style="margin-top:10px; border:none; background:#eee; padding:5px 15px; border-radius:10px; cursor:pointer; font-size:0.8rem;">ç™»å‡ºå¸³è™Ÿ</button>
        </div>

        <div class="menu-list" style="margin: 0 auto;">
            
            <div id="adminBtn" class="category-label" style="display:none; color:var(--t); cursor:pointer;" onclick="toggleAdminPanel()">âš™ï¸ ç®¡ç†å“¡å¾Œå° (é»æ“ŠæŒ‡æ´¾è·ä½æˆ–ç§»é™¤å¸³è™Ÿ)</div>
            <div id="adminPanel" class="admin-panel"><div id="studentList"></div></div>

            <div class="category-label">ğŸ“š å­¸æ¥­èˆ‡å·¥å…· (æ–°åŠŸèƒ½)</div>
            <a href="homework.html" class="menu-item homework">
                <div class="icon-box">âœï¸</div>
                <div class="info"><h2>å„ç§‘ä½œæ¥­æé†’</h2><p>ç”±å­¸ç§‘è‚¡é•·ç™¼ä½ˆä½œæ¥­æ¸…å–®</p></div>
                <div style="color:#ced4da;">â¯</div>
            </a>
            <a href="pdf_tools.html" class="menu-item pdf-tool">
                <div class="icon-box">ğŸ“</div>
                <div class="info"><h2>å­¸ç¿’æ­·ç¨‹æª”æ¡ˆå£“ç¸®</h2><p>è‡ªå‹•ç¬¦åˆ 4MB/10MB é™åˆ¶</p></div>
                <div style="color:#ced4da;">â¯</div>
            </a>

            <div class="category-label">ğŸ”” æé†’ç³»åˆ—</div>
            <a href="è¡Œäº‹æ›†/index.html" class="menu-item calendar">
                <div class="icon-box">ğŸ“…</div>
                <div class="info"><h2>ç­ç´šé‡è¦è¡Œäº‹æ›†</h2><p>è€ƒè©¦ã€æ´»å‹•ã€è£œèª²æ—¥ç¨‹ä¸æ¼æ¥</p></div>
                <div style="color:#ced4da;">â¯</div>
            </a>
            <a href="countdown/index.html" class="menu-item timer">
                <div class="icon-box">â³</div>
                <div class="info"><h2>å¤§è€ƒèˆ‡æ—¥ç¨‹å€’æ•¸</h2><p>æŒæ¡çµ±æ¸¬ã€å­¸æ¸¬å€’æ•¸æ™‚é–“</p></div>
                <div style="color:#ced4da;">â¯</div>
            </a>

            <div class="category-label">ğŸ¤ äº’å‹•ç³»åˆ—</div>
            <a href="help/student.html" class="menu-item teacher-help">
                <div class="icon-box">ğŸŒ±</div>
                <div class="info"><h2>å°å¸«æ‚„æ‚„è©± (å¿ƒè²ç®±)</h2><p>é‡åˆ°å›°é›£äº†å—ï¼Ÿé»é€™è£¡ç§ä¸‹å‘Šè¨´è€å¸«</p></div>
                <div style="color:#ced4da;">â¯</div>
            </a>
            <a href="åŒ¿å/index.html" class="menu-item whisper">
                <div class="icon-box">ğŸ¤«</div>
                <div class="info"><h2>ç­ç´šåŒ¿åè¨±é¡˜æ± </h2><p>æœ‰ä»€éº¼æƒ³èªªçš„ï¼Ÿæ‚„æ‚„å‘Šè¨´å¤§å®¶</p></div>
                <div style="color:#ced4da;">â¯</div>
            </a>
            <a href="board/index.html" class="menu-item board">
                <div class="icon-box">ğŸ’¬</div>
                <div class="info"><h2>ç­ç´šäº’å‹•ç•™è¨€æ¿</h2><p>ç­ç´šäº‹å‹™å…¬é–‹è¨è«–å€</p></div>
                <div style="color:#ced4da;">â¯</div>
            </a>

            <div class="category-label">âš™ï¸ ç­å‹™è™•ç†</div>
            <a href="cleaning/index.html" class="menu-item duty">
                <div class="icon-box">ğŸ§¹</div>
                <div class="info"><h2>ç­ç´šå‹¤å‹™ç®¡ç†ç³»çµ±</h2><p>å…§å¤–è¡›ç”Ÿæª¢æŸ¥èˆ‡è¨˜é»çæ‡²çµ±è¨ˆ</p></div>
                <div style="color:#ced4da;">â¯</div>
            </a>
            <a href="seating/index.html" class="menu-item seat">
                <div class="icon-box">ğŸª‘</div>
                <div class="info"><h2>æ•¸ä½æ•™å®¤é¸ä½ç³»çµ±</h2><p>ç¾å ´è¶…åˆºæ¿€æŠ½ç±¤é¸ä½</p></div>
                <div style="color:#ced4da;">â¯</div>
            </a>
            <a href="vote/index.html" class="menu-item vote">
                <div class="icon-box">ğŸ—³ï¸</div>
                <div class="info"><h2>ç·šä¸ŠæŠ•ç¥¨æ±ºç­–ç³»çµ±</h2><p>é‡è¦ç­ç´šäº‹å‹™ä¸€éµè¡¨æ±º</p></div>
                <div style="color:#ced4da;">â¯</div>
            </a>
            <a href="grouping/index.html" class="menu-item group">
                <div class="icon-box">ğŸ²</div>
                <div class="info"><h2>éš¨æ©Ÿåˆ†çµ„å°å¹«æ‰‹</h2><p>è¼¸å…¥åå–®è‡ªå‹•å…¬å¹³åˆ†çµ„</p></div>
                <div style="color:#ced4da;">â¯</div>
            </a>

            <div class="category-label">ğŸ“Š æˆç¸¾ç³»åˆ—</div>
            <a href="exam_calc/index.html" class="menu-item exam">
                <div class="icon-box">ğŸ“</div>
                <div class="info"><h2>æ®µè€ƒæˆç¸¾åŠ æ¬Šè¨ˆç®—</h2><p>è¨ˆç®—æ®µè€ƒåŠ æ¬Šå¹³å‡åˆ†æ•¸</p></div>
                <div style="color:#ced4da;">â¯</div>
            </a>
            <a href="final_calc/index.html" class="menu-item final">
                <div class="icon-box">ğŸ“ˆ</div>
                <div class="info"><h2>ç§‘ç›®å­¸æœŸç¸½æˆç¸¾</h2><p>è¨ˆç®—å¹³æ™‚ã€æ®µè€ƒèˆ‡æœŸæœ«åŠ æ¬Š</p></div>
                <div style="color:#ced4da;">â¯</div>
            </a>
        </div>
    </div>

    <footer> Â© 2026 ç­ç´šæ•¸ä½æœå‹™ç³»çµ±<br>Designed by ç‹å®¥éˆ </footer>

    <script>
        // Firebase é…ç½® (å»¶ç”¨æ‚¨çš„è³‡è¨Š)
        const firebaseConfig = { 
            apiKey: "AIzaSyCJavnjgSkyTzhoT5g9Retmyg005-gbld0",
            authDomain: "vote-6668.firebaseapp.com",
            projectId: "vote-6668",
            storageBucket: "vote-6668.firebasestorage.app",
            messagingSenderId: "389284021944",
            appId: "1:389284021944:web:3c5311697cbfc7c010564d"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let me = null;

        // --- ç™»å…¥é‚è¼¯ ---
        async function doLogin() {
            const id = document.getElementById('stuId').value.padStart(2, '0');
            const pw = document.getElementById('stuPw').value;
            if(!id || !pw) return alert("è«‹è¼¸å…¥å®Œæ•´å¸³å¯†");

            const doc = await db.collection("students").doc(id).get();
            if (doc.exists && doc.data().password === pw) {
                me = { id, ...doc.data() };
                sessionStorage.setItem('user', JSON.stringify(me));
                enterMain();
            } else alert("åº§è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤");
        }

        // --- è¨»å†Šé‚è¼¯ ---
        async function doRegister() {
            const id = document.getElementById('regId').value.padStart(2, '0');
            const name = document.getElementById('regName').value;
            const pw = document.getElementById('regPw').value;
            const role = document.getElementById('regRole').value;
            if(!id || !name || !pw) return alert("è«‹å¡«å¯«å®Œæ•´è³‡è¨Š");
            
            await db.collection("students").doc(id).set({
                name, password: pw, role, subject_role: "ç„¡"
            });
            alert("å¸³è™Ÿå·²å»ºç«‹ï¼è«‹ç™»å…¥");
            toggleAuth(false);
        }

        function enterMain() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('helloTitle').innerText = `ä½ å¥½ï¼Œ${me.name}`;
            document.getElementById('roleTitle').innerText = `èº«åˆ†ï¼š${me.role === 'teacher' ? 'å°å¸«' : 'å­¸ç”Ÿ'} | è·ä½ï¼š${me.subject_role || 'ç„¡'}`;

            if (me.role === 'teacher') {
                document.getElementById('adminBtn').style.display = 'block';
                loadAdminData();
            }
        }

        function loadAdminData() {
            db.collection("students").orderBy(firebase.firestore.FieldPath.documentId()).onSnapshot(snap => {
                const box = document.getElementById('studentList');
                box.innerHTML = "";
                snap.forEach(doc => {
                    const d = doc.data();
                    box.innerHTML += `
                        <div class="stu-row">
                            <span><b>${doc.id}</b> ${d.name}</span>
                            <select onchange="updateSubRole('${doc.id}', this.value)" style="width:80px; padding:2px; border-radius:5px;">
                                <option value="ç„¡" ${d.subject_role==='ç„¡'?'selected':''}>è·ä½</option>
                                <option value="åœ‹æ–‡" ${d.subject_role==='åœ‹æ–‡'?'selected':''}>åœ‹æ–‡</option>
                                <option value="è‹±æ–‡" ${d.subject_role==='è‹±æ–‡'?'selected':''}>è‹±æ–‡</option>
                                <option value="æ•¸å­¸" ${d.subject_role==='æ•¸å­¸'?'selected':''}>æ•¸å­¸</option>
                                <option value="ç‰©ç†" ${d.subject_role==='ç‰©ç†'?'selected':''}>ç‰©ç†</option>
                                <option value="åŒ–å­¸" ${d.subject_role==='åŒ–å­¸'?'selected':''}>åŒ–å­¸</option>
                            </select>
                            <button onclick="deleteAccount('${doc.id}')" style="background:var(--t); color:white; border:none; padding:4px 8px; border-radius:8px;">åˆªé™¤</button>
                        </div>`;
                });
            });
        }

        async function updateSubRole(sid, role) {
            await db.collection("students").doc(sid).update({ subject_role: role });
        }

        async function deleteAccount(sid) {
            if(confirm(`è­¦å‘Šï¼šç¢ºå®šè¦æ°¸ä¹…ç§»é™¤åº§è™Ÿ ${sid} çš„å¸³è™Ÿå—ï¼Ÿ`)) {
                await db.collection("students").doc(sid).delete();
            }
        }

        function toggleAdminPanel() {
            const p = document.getElementById('adminPanel');
            p.style.display = p.style.display === 'none' ? 'block' : 'none';
        }

        function toggleAuth(isReg) {
            document.getElementById('loginForm').style.display = isReg ? 'none' : 'block';
            document.getElementById('regForm').style.display = isReg ? 'block' : 'none';
            document.getElementById('authTitle').innerText = isReg ? 'å»ºç«‹æ–°å¸³è™Ÿ' : 'ç­ç´šé›²ç«¯æœå‹™';
        }

        function logout() { sessionStorage.clear(); location.reload(); }

        // æª¢æŸ¥æ˜¯å¦å·²ç¶“ç™»å…¥é
        window.onload = () => {
            const savedUser = sessionStorage.getItem('user');
            if (savedUser) {
                me = JSON.parse(savedUser);
                enterMain();
            }
        };
    </script>
</body>
</html>
