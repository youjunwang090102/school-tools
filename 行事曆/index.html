<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­ç´šè¡Œäº‹æ›† - 2026 ç®¡ç†ç‰ˆ</title>
    <style>
        :root { --primary: #4361ee; --warn: #f39c12; --danger: #e74c3c; --bg: #f8faff; }
        body { font-family: "PingFang TC", sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        
        /* é ‚éƒ¨å¡ç‰‡å€ */
        .summary-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .info-card { background: white; border-radius: 16px; padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border-top: 5px solid var(--primary); }
        .info-card.urgent { border-top-color: var(--danger); }
        .info-card h3 { margin: 0 0 10px 0; font-size: 1rem; color: #64748b; }
        .event-item { font-size: 0.9rem; padding: 5px 0; border-bottom: 1px dashed #edf2f7; display: flex; justify-content: space-between; }
        .event-item:last-child { border: none; }

        /* æœˆæ›†æ¨£å¼ */
        .calendar-card { background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
        .cal-day-name { text-align: center; font-weight: bold; color: #94a3b8; font-size: 0.8rem; padding-bottom: 10px; }
        .cal-cell { aspect-ratio: 1; border: 1px solid #f1f5f9; border-radius: 8px; padding: 5px; position: relative; cursor: pointer; transition: 0.2s; }
        .cal-cell:hover { background: #f1f5f9; }
        .cal-cell.today { border: 2px solid var(--primary); background: #eff6ff; }
        .cal-cell .day-num { font-size: 0.8rem; font-weight: 600; }
        .dot { width: 6px; height: 6px; background: var(--primary); border-radius: 50%; margin: 2px auto; }

        /* å½ˆçª—æ¨£å¼ */
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:100; backdrop-filter: blur(4px); }
        .modal-content { background:white; width:90%; max-width:400px; margin: 100px auto; padding:25px; border-radius:20px; }
        .visual-input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .btn { background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; width: 100%; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align: center;">ğŸ“… ç­ç´šè¡Œå‹•è¡Œäº‹æ›†</h2>

    <div class="summary-container">
        <div class="info-card" id="thisWeekCard">
            <h3>ğŸ“ æœ¬é€±äº‹é … (Sun-Sat)</h3>
            <div id="weekList">è®€å–ä¸­...</div>
        </div>
        <div class="info-card urgent" id="tenDaysCard">
            <h3>ğŸš€ 10å¤©å…§é å‘Š</h3>
            <div id="tenDaysList">è®€å–ä¸­...</div>
        </div>
    </div>

    <div class="calendar-card">
        <div class="cal-header">
            <button onclick="changeMonth(-1)">â—€</button>
            <h2 id="currentMonthLabel">2026å¹´ 2æœˆ</h2>
            <button onclick="changeMonth(1)">â–¶</button>
        </div>
        <div class="cal-grid" id="calendarGrid">
            </div>
        <button onclick="checkAdmin()" style="margin-top:20px; background:none; border:1px dashed #ccc; width:100%; color:#999; padding:10px; border-radius:10px; cursor:pointer;">ï¼‹ æ–°å¢äº‹é … (æ¬Šé™é©—è­‰)</button>
    </div>
</div>

<div id="addModal" class="modal">
    <div class="modal-content">
        <h3>æ–°å¢ç­ç´šäº‹é …</h3>
        <input type="text" id="eventTitle" class="visual-input" placeholder="äº‹é …åç¨± (å¦‚ï¼šè‹±æ–‡å–®å­—å°è€ƒ)">
        <input type="date" id="eventDate" class="visual-input">
        <select id="eventLevel" class="visual-input">
            <option value="normal">ä¸€èˆ¬äº‹é …</option>
            <option value="important">é‡è¦è€ƒè©¦</option>
            <option value="activity">ç­ç´šæ´»å‹•</option>
        </select>
        <button class="btn" onclick="saveEvent()">ç¢ºèªå„²å­˜</button>
        <button onclick="closeModal()" style="background:none; border:none; color:gray; width:100%; margin-top:10px; cursor:pointer;">å–æ¶ˆ</button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore-compat.js"></script>

<script>
    // Firebase è¨­å®š (è«‹æ²¿ç”¨æ‚¨åŸæœ¬çš„é…ç½®)
    const firebaseConfig = {
        apiKey: "AIzaSyCJavnjgSkyTzhoT5g9Retmyg005-gbld0",
        authDomain: "vote-6668.firebaseapp.com",
        projectId: "vote-6668",
        storageBucket: "vote-6668.firebasestorage.app",
        messagingSenderId: "389284021944",
        appId: "1:389284021944:web:3c5311697cbfc7c010564d"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let currentViewDate = new Date();
    let allEvents = [];

    // åˆå§‹åŒ–è®€å–
    async function init() {
        db.collection("calendar_events").onSnapshot(snapshot => {
            allEvents = snapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
            renderSummary();
            renderCalendar();
        });
    }

    function renderSummary() {
        const now = new Date();
        now.setHours(0,0,0,0);
        
        // æœ¬é€± (è¨ˆç®—åˆ°æœ¬é€±å…­)
        const weekEnd = new Date(now);
        weekEnd.setDate(now.getDate() + (6 - now.getDay()));
        
        // 10å¤©å…§
        const tenDaysEnd = new Date(now);
        tenDaysEnd.setDate(now.getDate() + 10);

        const weekList = allEvents.filter(e => {
            const d = new Date(e.date);
            return d >= now && d <= weekEnd;
        }).sort((a,b) => a.date.localeCompare(b.date));

        const tenDaysList = allEvents.filter(e => {
            const d = new Date(e.date);
            return d >= now && d <= tenDaysEnd;
        }).sort((a,b) => a.date.localeCompare(b.date));

        document.getElementById('weekList').innerHTML = weekList.length ? 
            weekList.map(e => `<div class="event-item"><span>${e.title}</span><small>${e.date.split('-')[2]}æ—¥</small></div>`).join('') : "æœ¬é€±ç„¡äº‹ ğŸ‰";
        
        document.getElementById('tenDaysList').innerHTML = tenDaysList.length ? 
            tenDaysList.map(e => `<div class="event-item"><span>${e.title}</span><small>${e.date.substring(5)}</small></div>`).join('') : "è¿‘æœŸç„¡äº‹";
    }

    function renderCalendar() {
        const grid = document.getElementById('calendarGrid');
        const label = document.getElementById('currentMonthLabel');
        grid.innerHTML = "";
        
        const year = currentViewDate.getFullYear();
        const month = currentViewDate.getMonth();
        label.innerText = `${year}å¹´ ${month + 1}æœˆ`;

        // æ˜ŸæœŸæ¬„ä½
        ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'].forEach(d => {
            grid.innerHTML += `<div class="cal-day-name">${d}</div>`;
        });

        const firstDay = new Date(year, month, 1).getDay();
        const lastDate = new Date(year, month + 1, 0).getDate();

        // è£œç©ºç™½æ ¼
        for(let i=0; i<firstDay; i++) grid.innerHTML += `<div></div>`;

        // å¡«å……æ—¥æœŸ
        for(let d=1; d<=lastDate; d++) {
            const dateStr = `${year}-${(month+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`;
            const isToday = new Date().toISOString().split('T')[0] === dateStr;
            const hasEvent = allEvents.some(e => e.date === dateStr);
            
            grid.innerHTML += `
                <div class="cal-cell ${isToday?'today':''}" onclick="showDayDetail('${dateStr}')">
                    <span class="day-num">${d}</span>
                    ${hasEvent ? `<div class="dot"></div>` : ''}
                </div>`;
        }
    }

    function changeMonth(step) {
        currentViewDate.setMonth(currentViewDate.getMonth() + step);
        renderCalendar();
    }

    // ç®¡ç†å“¡æ¬Šé™æª¢æŸ¥ (ç°¡å–®æ¨¡æ“¬æ‚¨ä¹‹å‰çš„é©—è­‰)
    function checkAdmin() {
        const pass = prompt("è«‹è¼¸å…¥ç®¡ç†é‡‘é‘°ä»¥æ–°å¢äº‹é …ï¼š");
        if(pass === "Admin88888") { // å»ºè­°æ”¹ç”¨æ‚¨åŸæœ¬çš„ PASSWORDS é‚è¼¯
            document.getElementById('addModal').style.display = 'block';
        } else {
            alert("æ¬Šé™ä¸è¶³");
        }
    }

    async function saveEvent() {
        const title = document.getElementById('eventTitle').value;
        const date = document.getElementById('eventDate').value;
        const level = document.getElementById('eventLevel').value;

        if(!title || !date) return alert("è«‹å¡«å¯«å®Œæ•´è³‡è¨Š");

        await db.collection("calendar_events").add({ title, date, level, createdAt: Date.now() });
        closeModal();
        alert("æ–°å¢æˆåŠŸï¼");
    }

    function closeModal() { document.getElementById('addModal').style.display = 'none'; }
    
    function showDayDetail(dateStr) {
        const dayEvents = allEvents.filter(e => e.date === dateStr);
        if(dayEvents.length > 0) {
            alert(`${dateStr} äº‹é …ï¼š\n` + dayEvents.map(e => `Â· ${e.title}`).join('\n'));
        }
    }

    init();
</script>
</body>
</html>
