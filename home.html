<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ç­ç´šæ•¸ä½å¹³å° v4.2.0 (æ——è‰¦å®Œæ•´ç‰ˆ)</title>

    <meta name="theme-color" id="chrome-theme" content="#f8fafc">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" id="safari-theme" content="default">

    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-auth-compat.js"></script>

    <script>
        (function() {
            const theme = localStorage.getItem('theme') || 'light';
            const layout = localStorage.getItem('layout') || 'list-mode';
            const lastPage = localStorage.getItem('lastPage') || '0';
            if (theme === 'dark') document.documentElement.classList.add('dark-mode');
            document.documentElement.setAttribute('data-layout', layout);
            document.documentElement.setAttribute('data-init-page', lastPage);
            const gateStyle = document.createElement('style');
            gateStyle.innerHTML = `body { opacity: 0; } [data-system-ready="true"] body { opacity: 1; transition: opacity 0.3s ease; }`;
            document.head.appendChild(gateStyle);
        })();

        const SYS_CONFIG = {
            banner: "ğŸ“ æ•™è‚²é«”ç³»é©—è­‰å·²å•Ÿç”¨ã€‚è«‹ä½¿ç”¨å­¸æ ¡é…ç™¼ä¹‹æ•™è‚²ä¿¡ç®±é€²è¡Œè¨»å†Šã€‚",
            author: {
                name: "ç‹å®¥éˆ",
                role: "é–‹ç™¼è€… ï½œ Developer",
                ver: "v4.2.0 (Elite Edition)",
                updates: [
                    "âœ¨ [å…¨æ–°] æ•´åˆ Firebase Auth å¸³è™Ÿç®¡ç†ç³»çµ±ã€‚",
                    "âœ¨ [å®‰å…¨] æ”¯æ´æ•™è‚²ä¿¡ç®± (@go.edu.tw) ç¡¬æ€§ç¶å®šæ ¡é©—ã€‚",
                    "âœ¨ [é«”é©—] ä¿ç•™å®Œæ•´ 3D ç‰©ç†å¼•æ“èˆ‡å¡ç‰‡æ‹–æ›³æ’åºåŠŸèƒ½ã€‚",
                    "âœ¨ [ä»‹é¢] å¼·åŒ–æ¯›ç»ç’ƒé–€æ§è¦–è¦ºï¼Œä¿è­·å…§éƒ¨æ•¸æ“šéš±ç§ã€‚"
                ]
            }
        };
    </script>

    <style>
        /* =============================================
           ğŸ¨ 1. æ ¸å¿ƒè®Šæ•¸èˆ‡æ——è‰¦ç‰ˆè¦–è¦ºç³»çµ±
           ============================================= */
        :root {
            --p: #4361ee; --p-light: rgba(67, 97, 238, 0.1); --g: #7209b7; 
            --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --sub: #64748b; 
            --border: rgba(0,0,0,0.08); --nav-bg: rgba(255, 255, 255, 0.85); 
            --banner-bg: #fff9db; --banner-text: #856404; --accent: #4361ee;
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }
        .dark-mode {
            --bg: #020617; --card: #111827; --text: #f8fafc; --sub: #94a3b8; 
            --border: rgba(255,255,255,0.1); --nav-bg: rgba(15, 23, 42, 0.85); 
            --banner-bg: #1e1b0a; --banner-text: #ffe066; --accent: #fbbf24;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; width: 100vw; height: 100dvh; background-color: var(--bg); color: var(--text); font-family: 'PingFang TC', system-ui, sans-serif; overflow: hidden; position: fixed; }

        /* =============================================
           ğŸ›¡ï¸ 2. é–€æ§ä»‹é¢ (Auth Portal) - å¯¦æ™‚æ¯›ç»ç’ƒå±¤
           ============================================= */
        #auth-portal {
            position: fixed; inset: 0; background: var(--bg); z-index: 10000;
            display: flex; align-items: center; justify-content: center; padding: 20px;
            transition: all 0.8s cubic-bezier(0.7, 0, 0.3, 1);
        }
        #auth-portal.hide { transform: scale(1.1); opacity: 0; pointer-events: none; }

        .auth-card {
            background: var(--card); width: 100%; max-width: 440px;
            border-radius: 40px; padding: 45px 35px; border: 1px solid var(--border);
            box-shadow: 0 30px 60px rgba(0,0,0,0.12); text-align: center;
        }
        .auth-card h2 { margin: 0; color: var(--p); font-size: 28px; font-weight: 900; }
        .auth-input-group { margin-bottom: 18px; text-align: left; }
        .auth-input-group label { display: block; font-size: 13px; font-weight: 800; margin-bottom: 8px; color: var(--sub); margin-left: 12px; }
        .auth-input {
            width: 100%; padding: 16px 22px; border-radius: 20px; border: 2.5px solid var(--border);
            background: var(--bg); color: var(--text); font-size: 16px; font-weight: 600; outline: none; transition: 0.3s;
        }
        .auth-input:focus { border-color: var(--p); box-shadow: 0 0 0 5px var(--p-light); }
        .auth-btn { width: 100%; padding: 18px; background: var(--p); color: white; border: none; border-radius: 22px; font-weight: 900; font-size: 17px; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        .auth-btn:hover { transform: translateY(-3px); box-shadow: 0 12px 24px rgba(67, 97, 238, 0.3); }

        /* =============================================
           ğŸ“± 3. åŸå§‹ä»‹é¢èˆ‡å‹•ç•«æ•ˆæœé‚„åŸ
           ============================================= */
        header { height: 72px; padding: 0 20px; background: var(--nav-bg); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: relative; z-index: 1000; }
        .brand h1 { margin: 0; font-size: 20px; font-weight: 900; color: var(--p); letter-spacing: -0.5px; }
        .brand p { margin: 0; font-size: 10px; color: var(--sub); font-weight: 800; letter-spacing: 1.2px; text-transform: uppercase; }

        .icon-btn { border: none; background: transparent; cursor: pointer; width: 40px; height: 34px; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: var(--sub); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .icon-btn.active { background: var(--p); color: #ffffff !important; box-shadow: 0 4px 12px rgba(67, 97, 238, 0.4); transform: scale(1.05); }
        .dark-mode .icon-btn.active { background: var(--accent); color: #000; box-shadow: 0 0 15px rgba(251, 191, 36, 0.3); }

        .viewport { width: 100%; height: calc(100dvh - 72px - 40px); display: flex; overflow-x: auto; overflow-y: hidden; scroll-snap-type: x mandatory; scrollbar-width: none; -webkit-overflow-scrolling: touch; }
        .page-panel { flex: 0 0 100%; width: 100%; height: 100%; scroll-snap-align: start; overflow-y: auto; padding: 25px 20px 180px; box-sizing: border-box; }
        .content-grid { display: grid; gap: 18px; width: 100%; max-width: 1100px; margin: 0 auto; }

        /* âœ¨ æ——è‰¦ç‰ˆï¼š3D ç‰©ç†å¡ç‰‡ç³»çµ±é‚„åŸ */
        .card {
            background: var(--card); border: 1px solid var(--border); border-radius: 24px; text-decoration: none; color: inherit;
            display: flex; position: relative; overflow: hidden; transform-style: preserve-3d;
            transform: perspective(1000px) rotateX(var(--rx, 0deg)) rotateY(var(--ry, 0deg)) scale3d(var(--scale, 1), var(--scale, 1), 1);
            transition: transform 0.15s ease-out, background 0.3s ease, box-shadow 0.3s ease; will-change: transform; cursor: grab;
            user-select: none; -webkit-user-select: none;
        }
        .card:active { --scale: 0.96; cursor: grabbing; }
        .card.dragging { opacity: 0.3; transform: scale3d(0.92, 0.92, 1); z-index: 50; }
        .card::after { content: ""; position: absolute; inset: 0; background: radial-gradient(350px circle at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(67, 97, 238, 0.08), transparent 40%); opacity: 0; transition: opacity 0.4s; pointer-events: none; }
        [data-layout="list-mode"] .card { padding: 22px; align-items: center; }
        [data-layout="grid-mode"] .card { flex-direction: column; padding: 20px 10px; text-align: center; aspect-ratio: 1 / 1.1; justify-content: center; }
        
        .card-icon { display: flex; align-items: center; justify-content: center; background: var(--p-light); color: var(--p); width: 56px; height: 56px; border-radius: 16px; margin-right: 20px; font-size: 24px; }
        [data-layout="grid-mode"] .card-icon { width: 48px; height: 48px; border-radius: 50%; margin: 0 auto 12px; }

        .nav-dock { position: fixed; bottom: calc(25px + var(--safe-bottom)); left: 50%; transform: translateX(-50%); width: 92%; max-width: 440px; z-index: 5000; }
        .nav-glass { background: var(--nav-bg); backdrop-filter: blur(25px); display: flex; padding: 6px; border-radius: 100px; border: 1px solid var(--border); box-shadow: 0 15px 40px rgba(0,0,0,0.2); }
        .nav-item { flex: 1; text-align: center; padding: 14px 0; font-size: 14px; font-weight: 900; color: var(--sub); cursor: pointer; border-radius: 100px; transition: 0.4s; }
        .nav-item.active { color: #ffffff; background: var(--p); box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3); }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(12px); z-index: 9999; display: none; align-items: center; justify-content: center; padding: 25px; }
        .overlay.active { display: flex; }
        .modal { background: var(--bg); width: 100%; max-width: 360px; border-radius: 35px; overflow: hidden; border: 1px solid var(--border); animation: modalPop 0.4s cubic-bezier(0.17, 0.89, 0.32, 1.28); }
    </style>
</head>
<body data-layout="list-mode">

    <div id="auth-portal">
        <div class="auth-card" id="login-form">
            <h2>å¹³å°ç™»å…¥</h2>
            <p>è«‹ä½¿ç”¨ 6 ç¢¼å­¸è™Ÿèˆ‡å¯†ç¢¼é€²å…¥</p>
            <div class="auth-input-group"><label>å­¸è™Ÿ</label><input type="number" id="auth-id" class="auth-input" placeholder="ä¾‹: 112001"></div>
            <div class="auth-input-group"><label>å¯†ç¢¼</label><input type="password" id="auth-pw" class="auth-input" placeholder="è«‹è¼¸å…¥å¯†ç¢¼"></div>
            <button class="auth-btn" onclick="sysAuth.doLogin()">é€²å…¥æ•¸ä½å¹³å°</button>
            <p onclick="sysAuth.switchMode('reg')" style="cursor:pointer; color:var(--p); font-weight:700; margin-top:20px;">æ–°åŒå­¸ï¼Ÿé»æ­¤è¨»å†Š</p>
        </div>

        <div class="auth-card" id="reg-form" style="display:none;">
            <h2>è¨»å†Šç”³è«‹</h2>
            <p>ç¶å®šæ•™è‚²ä¿¡ç®±ä»¥å®Œæˆèº«åˆ†é©—è­‰</p>
            <div class="auth-input-group"><label>å­¸è™Ÿ (6ç¢¼)</label><input type="number" id="reg-id" class="auth-input" placeholder="ä¾‹: 112001"></div>
            <div class="auth-input-group"><label>çœŸå¯¦å§“å</label><input type="text" id="reg-name" class="auth-input" placeholder="ä¾‹: ç‹å¤§åŒ"></div>
            <div class="auth-input-group"><label>æ‰€å±¬ç­ç´š</label><select id="reg-class" class="auth-input" style="appearance:none;"><option value="è³‡ä¸‰ç”²">è³‡ä¸‰ç”²</option><option value="è³‡ä¸‰ä¹™">è³‡ä¸‰ä¹™</option></select></div>
            <div class="auth-input-group"><label>æ•™è‚²ä¿¡ç®± (@go.edu.tw)</label><input type="email" id="reg-email" class="auth-input" placeholder="ä¾‹: 112001@go.edu.tw"></div>
            <div class="auth-input-group"><label>è¨­å®šå¯†ç¢¼</label><input type="password" id="reg-pw" class="auth-input" placeholder="è«‹è¨­å®š 6 ç¢¼ä»¥ä¸Šå¯†ç¢¼"></div>
            <button class="auth-btn" style="background:#10b981" onclick="sysAuth.doRegister()">é€å‡ºè¨»å†Š</button>
            <p onclick="sysAuth.switchMode('login')" style="cursor:pointer; color:var(--p); font-weight:700; margin-top:20px;">å·²æœ‰å¸³è™Ÿï¼Ÿè¿”å›ç™»å…¥</p>
        </div>
    </div>

    <div class="top-notice" id="ui-banner"></div>
    <header>
        <div class="brand"><h1>ç­ç´šæ•¸ä½å¹³å°</h1><p id="auth-status-text">Digital Classroom System</p></div>
        <div class="controls">
            <div class="toggle-group">
                <button class="icon-btn" id="listToggle" onclick="updateLayout('list-mode')"><svg viewBox="0 0 24 24"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><path d="M3 6h.01M3 12h.01M3 18h.01"/></svg></button>
                <button class="icon-btn" id="gridToggle" onclick="updateLayout('grid-mode')"><svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg></button>
            </div>
            <button class="icon-btn circle-tool" onclick="updateTheme()"><svg id="theme-icon" viewBox="0 0 24 24"></svg></button>
            <button class="icon-btn circle-tool" onclick="sysAuth.doLogout()"><svg viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg></button>
        </div>
    </header>

    <main class="viewport" id="scroll-engine">
        <section class="page-panel" id="panel-0"><div class="content-grid" id="grid-0">
            <a href="è¡Œäº‹æ›†/index.html" class="card" draggable="true"><div class="card-icon">ğŸ“…</div><div class="card-info"><h2>ç­ç´šè¡Œäº‹æ›†</h2><p>æŒæ¡è€ƒç¨‹èˆ‡é‡è¦æ´»å‹•ä¸æ¼æ¥</p></div></a>
            <a href="countdown/index.html" class="card" draggable="true"><div class="card-icon">â³</div><div class="card-info"><h2>è€ƒç¨‹å€’æ•¸</h2><p>å€’æ•¸æ®µè€ƒèˆ‡çµ±æ¸¬</p></div></a>
            <a href="homework/index.html" class="card" draggable="true"><div class="card-icon">ğŸ“’</div><div class="card-info"><h2>ä½œæ¥­å¾…è¾¦</h2><p>å³æ™‚æŸ¥çœ‹ä½œæ¥­ä¸éºæ¼</p></div></a>
        </div></section>

        <section class="page-panel" id="panel-1"><div class="content-grid" id="grid-1">
            <a href="help/student.html" class="card" draggable="true"><div class="card-icon">ğŸŒ±</div><div class="card-info"><h2>åŒ¿åæ±‚åŠ©</h2><p>å®‰å…¨ä¸”ç§å¯†çš„æ±‚åŠ©ç®¡é“</p></div></a>
            <a href="unknownmail/index.html" class="card" draggable="true"><div class="card-icon">âœ‰ï¸</div><div class="card-info"><h2>åŒ¿åä¿¡ç®±</h2><p>æº«é¦¨æé†’åŒå­¸çš„å°å·¥å…·</p></div></a>
            <a href="åŒ¿å/index.html" class="card" draggable="true"><div class="card-icon">âœ¨</div><div class="card-info"><h2>åŒ¿åè¨±é¡˜æ± </h2><p>åˆ†äº«ä½ çš„ç¾å¥½é»å­</p></div></a>
            <a href="board/index.html" class="card" draggable="true"><div class="card-icon">ğŸ’¬</div><div class="card-info"><h2>å¯¦åç•™è¨€æ¿</h2><p>èˆ‡ç­ä¸ŠåŒå­¸äº’å‹•äº¤æµ</p></div></a>
        </div></section>

        <section class="page-panel" id="panel-2"><div class="content-grid" id="grid-2">
            <a href="cleaning/index.html" class="card" draggable="true"><div class="card-icon">ğŸ§¹</div><div class="card-info"><h2>æ‰“æƒå‹¤å‹™</h2><p>æŸ¥çœ‹æƒå€èˆ‡ç¼ºå¤±é»æ•¸</p></div></a>
            <a href="seating/index.html" class="card" draggable="true"><div class="card-icon">ğŸª‘</div><div class="card-info"><h2>é¸ä½ç³»çµ±</h2><p>åˆºæ¿€ä¸”å…¬å¹³çš„åº§ä½æ’å®š</p></div></a>
            <a href="vote/index.html" class="card" draggable="true"><div class="card-icon">ğŸ—³ï¸</div><div class="card-info"><h2>æ•¸ä½æŠ•ç¥¨</h2><p>æ±ºå®šç­ç´šçš„å¤§å°äº‹å‹™</p></div></a>
        </div></section>

        <section class="page-panel" id="panel-3"><div class="content-grid" id="grid-3">
            <a href="exam_calc/index.html" class="card" draggable="true"><div class="card-icon">ğŸ“</div><div class="card-info"><h2>æ®µè€ƒåŠ æ¬Š</h2><p>å¹³å‡åˆ†èˆ‡ç¸½åˆ†è¨ˆç®—</p></div></a>
            <a href="final_calc/index.html" class="card" draggable="true"><div class="card-icon">ğŸ“ˆ</div><div class="card-info"><h2>å­¸æœŸç¸½åˆ†</h2><p>å­¸åˆ†å–å¾—èˆ‡é è­¦åˆ¤æ–·</p></div></a>
        </div></section>
    </main>

    <nav class="nav-dock">
        <div class="nav-glass">
            <div class="nav-item active" onclick="moveTo(0)">æé†’</div>
            <div class="nav-item" onclick="moveTo(1)">äº’å‹•</div>
            <div class="nav-item" onclick="moveTo(2)">ç­å‹™</div>
            <div class="nav-item" onclick="moveTo(3)">æˆç¸¾</div>
        </div>
    </nav>

    <script>
        // 1. åˆå§‹åŒ– Firebase
        const firebaseConfig = { apiKey: "AIzaSyCJavnjgSkyTzhoT5g9Retmyg005-gbld0", authDomain: "vote-6668.firebaseapp.com", projectId: "vote-6668", storageBucket: "vote-6668.firebasestorage.app", messagingSenderId: "389284021944", appId: "1:389284021944:web:3c5311697cbfc7c010564d" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(), auth = firebase.auth();

        let me = null;

        // ğŸ›¡ï¸ SSO èº«åˆ†é©—è­‰æ¨¡çµ„
        const sysAuth = {
            switchMode: (mode) => {
                document.getElementById('login-form').style.display = mode === 'login' ? 'block' : 'none';
                document.getElementById('reg-form').style.display = mode === 'reg' ? 'block' : 'none';
            },
            doLogin: async () => {
                const id = document.getElementById('auth-id').value;
                const pw = document.getElementById('auth-pw').value;
                // ğŸ’¡ ä½¿ç”¨å­¸è™ŸåŠ ä¸Šå›ºå®šå¾Œç¶´ç™»å…¥
                const email = `${id}@class.local`;
                try {
                    await auth.signInWithEmailAndPassword(email, pw);
                } catch (e) { alert("ç™»å…¥å¤±æ•—ï¼šå­¸è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤"); }
            },
            doRegister: async () => {
                const id = document.getElementById('reg-id').value;
                const email = document.getElementById('reg-email').value;
                const name = document.getElementById('reg-name').value;
                const pw = document.getElementById('reg-pw').value;
                const cls = document.getElementById('reg-class').value;

                if(id.length !== 6) return alert("å­¸è™Ÿå¿…é ˆç‚º 6 ç¢¼");
                if(!email.endsWith("@go.edu.tw")) return alert("å¿…é ˆä½¿ç”¨æ•™è‚²ä¿¡ç®±è¨»å†Š");
                if(!email.startsWith(id)) return alert("å­¸è™Ÿèˆ‡æ•™è‚²ä¿¡ç®±ä¸åŒ¹é…");

                try {
                    // é€™è£¡çš„ä¸» Auth ä¾ç„¶ä½¿ç”¨ id@class.local ä»¥ä¿è­‰çµ±ä¸€æ€§ï¼Œä¿¡ç®±åƒ…ä½œè³‡æ–™ç´€éŒ„
                    const userEmail = `${id}@class.local`;
                    await auth.createUserWithEmailAndPassword(userEmail, pw);
                    await db.collection("students").doc(id).set({
                        name, classId: cls, eduMail: email, role: "student", status: "pending", createdAt: Date.now()
                    });
                    alert("è¨»å†ŠæˆåŠŸï¼è«‹å¾…å°å¸«å¯©æ ¸å•Ÿç”¨å¸³è™Ÿã€‚");
                    await auth.signOut();
                    sysAuth.switchMode('login');
                } catch (e) { alert("è¨»å†Šå¤±æ•—ï¼š" + e.message); }
            },
            doLogout: async () => { if(confirm("ç¢ºå®šç™»å‡ºï¼Ÿ")) { await auth.signOut(); location.reload(); } }
        };

        // ç›£è½ Auth
        auth.onAuthStateChanged(async (user) => {
            const portal = document.getElementById('auth-portal');
            if(user) {
                const id = user.email.split('@')[0];
                const doc = await db.collection("students").doc(id).get();
                if(doc.exists && doc.data().status === 'active') {
                    me = { id, ...doc.data() };
                    document.getElementById('auth-status-text').innerText = `${me.classId} ï½œ ${me.name}`;
                    portal.classList.add('hide');
                } else {
                    if(doc.exists && doc.data().status === 'pending') alert("å¸³è™Ÿå¯©æ ¸ä¸­ï¼Œè«‹ç¨å¾Œ");
                    await auth.signOut();
                }
            } else { portal.classList.remove('hide'); }
        });

        // ğŸ•¹ï¸ æ——è‰¦ç‰ˆæ§åˆ¶å™¨
        const Hub = {
            dom: { scroller: document.getElementById('scroll-engine'), tabs: document.querySelectorAll('.nav-item'), themeIcon: document.getElementById('theme-icon'), chromeMeta: document.getElementById('chrome-theme'), safariMeta: document.getElementById('safari-theme') },
            state: { currentIdx: parseInt(localStorage.getItem('lastPage')) || 0, isDark: document.documentElement.classList.contains('dark-mode'), layout: localStorage.getItem('layout') || 'list-mode' }
        };

        function moveTo(idx) {
            const width = Hub.dom.scroller.offsetWidth;
            Hub.dom.scroller.scrollTo({ left: idx * width, behavior: 'smooth' });
            Hub.state.currentIdx = idx;
            localStorage.setItem('lastPage', idx);
            Hub.dom.tabs.forEach((tab, i) => tab.classList.toggle('active', i === idx));
        }

        function updateLayout(mode) {
            document.documentElement.setAttribute('data-layout', mode);
            Hub.state.layout = mode;
            localStorage.setItem('layout', mode);
            document.getElementById('listToggle').classList.toggle('active', mode === 'list-mode');
            document.getElementById('gridToggle').classList.toggle('active', mode === 'grid-mode');
        }

        function updateTheme() {
            Hub.state.isDark = !Hub.state.isDark;
            document.documentElement.classList.toggle('dark-mode', Hub.state.isDark);
            localStorage.setItem('theme', Hub.state.isDark ? 'dark' : 'light');
            Hub.dom.themeIcon.innerHTML = Hub.state.isDark ? 'â˜€ï¸' : 'ğŸŒ‘';
        }

        // âœ¨ å¡ç‰‡ 3D èˆ‡æ‹–æ›³ç‰¹æ•ˆ
        function initCardFX() {
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                card.addEventListener('mousemove', e => {
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left, y = e.clientY - rect.top;
                    card.style.setProperty('--mouse-x', `${x}px`);
                    card.style.setProperty('--mouse-y', `${y}px`);
                    const rx = (y - rect.height/2) / (rect.height/2) * -8;
                    const ry = (x - rect.width/2) / (rect.width/2) * 8;
                    card.style.setProperty('--rx', `${rx}deg`);
                    card.style.setProperty('--ry', `${ry}deg`);
                    card.style.setProperty('--scale', `1.03`);
                });
                card.addEventListener('mouseleave', () => {
                    card.style.setProperty('--rx', `0deg`); card.style.setProperty('--ry', `0deg`); card.style.setProperty('--scale', `1`);
                });
                card.addEventListener('dragstart', function() { this.classList.add('dragging'); });
                card.addEventListener('dragend', function() { this.classList.remove('dragging'); });
            });
        }

        window.addEventListener('DOMContentLoaded', () => {
            document.getElementById('ui-banner').innerText = SYS_CONFIG.banner;
            Hub.dom.themeIcon.innerHTML = Hub.state.isDark ? 'â˜€ï¸' : 'ğŸŒ‘';
            initCardFX();
            updateLayout(Hub.state.layout);
            setTimeout(() => { moveTo(Hub.state.currentIdx); document.documentElement.setAttribute('data-system-ready', 'true'); }, 50);
        });
    </script>
</body>
</html>
