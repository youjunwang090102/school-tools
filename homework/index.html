<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å„ç§‘ä½œæ¥­æé†’ç³»çµ±</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore-compat.js"></script>
    <style>
        :root { --p: #6366f1; --s: #10b981; --bg: #f8fafc; --card: #ffffff; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 15px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 500px; background: var(--card); border-radius: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); overflow: hidden; }
        .header { background: var(--p); color: white; padding: 25px; text-align: center; }
        .content { padding: 20px; }
        input, select, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: 1px solid #e2e8f0; box-sizing: border-box; font-size: 16px; }
        button { background: var(--p); color: white; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { opacity: 0.9; }
        .hw-item { background: #f1f5f9; padding: 15px; border-radius: 12px; margin-bottom: 10px; border-left: 5px solid var(--p); position: relative; }
        .hw-subject { font-weight: bold; color: var(--p); font-size: 0.9rem; }
        .hw-title { font-size: 1.1rem; margin: 5px 0; color: #1e293b; }
        .hw-date { font-size: 0.8rem; color: #64748b; }
        .del-btn { position: absolute; right: 10px; top: 10px; background: #ff4d4f; color: white; padding: 4px 8px; border-radius: 5px; font-size: 0.7rem; border: none; cursor: pointer; }
        .admin-box { background: #fffbeb; border: 1px solid #fef3c7; padding: 15px; border-radius: 15px; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div id="loginView" class="content">
        <h2 style="text-align: center; color: var(--p);">ğŸ“ ä½œæ¥­æé†’ç™»å…¥</h2>
        <p style="text-align: center; color: #64748b; font-size: 0.9rem;">è«‹ä½¿ç”¨æ‰“æƒå¹³å°å¸³è™Ÿç™»å…¥</p>
        <input type="number" id="stuId" placeholder="åº§è™Ÿ">
        <input type="password" id="stuPw" placeholder="å¯†ç¢¼">
        <button onclick="doLogin()">ç™»å…¥ç³»çµ±</button>
    </div>

    <div id="mainView" style="display: none;">
        <div class="header">
            <h2 id="userHello" style="margin:0;"></h2>
            <p id="userRole" style="margin:5px 0 0 0; opacity: 0.8;"></p>
        </div>
        
        <div class="content">
            <div id="adminPanel" class="admin-box" style="display: none;">
                <h4 style="margin:0 0 10px 0;">ğŸ“¢ ç™¼ä½ˆæ–°ä½œæ¥­</h4>
                <select id="subject">
                    <option value="åœ‹æ–‡">åœ‹æ–‡</option><option value="è‹±æ–‡">è‹±æ–‡</option><option value="æ•¸å­¸">æ•¸å­¸</option>
                    <option value="ç‰©ç†">ç‰©ç†</option><option value="åŒ–å­¸">åŒ–å­¸</option><option value="ç”Ÿç‰©">ç”Ÿç‰©</option>
                    <option value="åœ°ç§‘">åœ°ç§‘</option><option value="åœ°ç†">åœ°ç†</option><option value="æ­·å²">æ­·å²</option>
                    <option value="å…¬æ°‘">å…¬æ°‘</option><option value="å…¶ä»–">å…¶ä»–</option>
                </select>
                <input type="text" id="hwTitle" placeholder="ä½œæ¥­å…§å®¹ (å¦‚ï¼šç¿’ä½œ P.10)">
                <input type="date" id="deadline">
                <button onclick="addHw()" style="background: var(--s);">ç™¼ä½ˆä½œæ¥­</button>
            </div>

            <h3>ğŸ“… ç›®å‰ä½œæ¥­æ¸…å–®</h3>
            <div id="hwList"></div>
            
            <button onclick="location.reload()" style="background:#94a3b8; margin-top: 20px;">ç™»å‡º</button>
        </div>
    </div>
</div>

<script>
    // âš ï¸ è«‹å‹™å¿…ä½¿ç”¨æ‚¨åŸæœ‰çš„ Firebase é…ç½®
    const firebaseConfig = { 
        apiKey: "AIzaSyCJavnjgSkyTzhoT5g9Retmyg005-gbld0",
        authDomain: "vote-6668.firebaseapp.com",
        projectId: "vote-6668",
        storageBucket: "vote-6668.firebasestorage.app",
        messagingSenderId: "389284021944",
        appId: "1:389284021944:web:3c5311697cbfc7c010564d"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let currentUser = null;

    async function doLogin() {
        const id = document.getElementById('stuId').value.padStart(2, '0');
        const pw = document.getElementById('stuPw').value;
        
        const doc = await db.collection("students").doc(id).get();
        if (doc.exists && doc.data().password === pw) {
            currentUser = { id, ...doc.data() };
            showMain();
        } else {
            alert("å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼");
        }
    }

    function showMain() {
        document.getElementById('loginView').style.display = 'none';
        document.getElementById('mainView').style.display = 'block';
        document.getElementById('userHello').innerText = `ä½ å¥½ï¼Œ${currentUser.name}`;
        document.getElementById('userRole').innerText = `èº«åˆ†ï¼š${translateRole(currentUser.role)}`;

        // å¦‚æœä¸æ˜¯ä¸€èˆ¬å­¸ç”Ÿï¼Œé¡¯ç¤ºç™¼ä½ˆé¢æ¿
        if (currentUser.role !== 'student') {
            document.getElementById('adminPanel').style.display = 'block';
        }

        loadHw();
    }

    function translateRole(r) {
        const roles = { teacher: "è€å¸«", admin: "ç®¡ç†å“¡", inner_manager: "å…§è¡›ç”Ÿ", outer_manager: "å¤–è¡›ç”Ÿ" };
        return roles[r] || "å­¸ç”Ÿ";
    }

    async function addHw() {
        const subject = document.getElementById('subject').value;
        const title = document.getElementById('hwTitle').value;
        const date = document.getElementById('deadline').value;

        if (!title || !date) return alert("è«‹å¡«å¯«å®Œæ•´è³‡è¨Š");

        await db.collection("homework_reminders").add({
            subject, title, date,
            createdAt: Date.now(),
            author: currentUser.name
        });
        
        document.getElementById('hwTitle').value = "";
        alert("ä½œæ¥­å·²ç™¼ä½ˆ");
    }

    function loadHw() {
        // ç›£è½ä½œæ¥­æ¸…å–®ï¼ŒæŒ‰æ—¥æœŸæ’åº
        db.collection("homework_reminders").orderBy("date", "asc").onSnapshot(snap => {
            const box = document.getElementById('hwList');
            box.innerHTML = "";
            snap.forEach(doc => {
                const d = doc.data();
                const isAuthor = (currentUser.role !== 'student'); 
                box.innerHTML += `
                    <div class="hw-item">
                        <div class="hw-subject">${d.subject}</div>
                        <div class="hw-title">${d.title}</div>
                        <div class="hw-date">æˆªæ­¢æ—¥æœŸï¼š${d.date} (ç™¼ä½ˆäººï¼š${d.author})</div>
                        ${isAuthor ? `<button class="del-btn" onclick="deleteHw('${doc.id}')">åˆªé™¤</button>` : ''}
                    </div>
                `;
            });
            if(snap.empty) box.innerHTML = "<p style='color:#999; text-align:center;'>ç›®å‰æ²’æœ‰ä½œæ¥­ï¼Œæ”¾å‡å›‰ï¼ğŸ‰</p>";
        });
    }

    async function deleteHw(id) {
        if (confirm("ç¢ºå®šç§»é™¤é€™é …ä½œæ¥­æé†’å—ï¼Ÿ")) {
            await db.collection("homework_reminders").doc(id).delete();
        }
    }
</script>
</body>
</html>
