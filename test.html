<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ClassHub Ultimate | The Pinnacle of Web Design</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* * =========================================
         * ğŸ¨ CORE DESIGN SYSTEM (CSS VARS)
         * =========================================
         */
        :root {
            /* åŸºç¤è‰²ç³» - ä½¿ç”¨ HSL å¯¦ç¾ç²¾æº–å‹•æ…‹æ§åˆ¶ */
            --h: 215; --s: 90%; --l: 60%;
            --primary: hsl(var(--h), var(--s), var(--l));
            --primary-rgb: 56, 189, 248;
            --accent: #f472b6;
            
            /* èƒŒæ™¯ç³»çµ± */
            --bg-base: #020617;
            --bg-surface: #0f172a;
            --bg-card: #1e293b;
            --glass: rgba(15, 23, 42, 0.8);
            
            /* æ–‡å­—ç³»çµ± */
            --text-p: #f8fafc;
            --text-s: #94a3b8;
            --text-dim: #64748b;
            
            /* ç‰©ç†åƒæ•¸ */
            --radius-lg: 32px;
            --radius-md: 20px;
            --radius-sm: 12px;
            --blur: 20px;
            --transition: 0.4s cubic-bezier(0.2, 0, 0, 1);
            
            /* è‡ªå®šç¾©å€‹äººåŒ–è®Šæ•¸ (ç”± JS å‹•æ…‹ä¿®æ”¹) */
            --p-scale: 1.0;
            --p-spacing: 16px;
            --p-weight: 500;
            --p-anim-speed: 0.5s;
            --p-glass-opacity: 0.8;
            
            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }

        /* æ·ºè‰²ä¸»é¡Œæ˜ å°„ */
        [data-theme="light"] {
            --bg-base: #f1f5f9;
            --bg-surface: #ffffff;
            --bg-card: #f8fafc;
            --text-p: #0f172a;
            --text-s: #475569;
            --text-dim: #94a3b8;
            --glass: rgba(255, 255, 255, 0.85);
        }

        /* * =========================================
         * ğŸ›  RESET & BASE STYLES
         * =========================================
         */
        * {
            margin: 0; padding: 0; box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
            scrollbar-width: none;
        }
        *::-webkit-scrollbar { display: none; }

        body {
            background-color: var(--bg-base);
            color: var(--text-p);
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            font-weight: var(--p-weight);
            line-height: 1.5;
            overflow: hidden; /* ç”±ç‰©ç†å¼•æ“æ§åˆ¶æ»¾å‹• */
            height: 100vh; width: 100vw;
            touch-action: none; /* ç¦ç”¨é è¨­æ‰‹å‹¢ */
        }

        /* * =========================================
         * ğŸ— LAYOUT ENGINE
         * =========================================
         */
        #app-canvas {
            position: relative; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            transition: transform var(--p-anim-speed) var(--transition);
        }

        /* ç•¶æŠ½å±œæ‰“é–‹æ™‚çš„èƒŒæ™¯ç¸®æ”¾æ•ˆæœ */
        body.sheet-open #app-canvas {
            transform: scale(0.92) translateY(-20px);
            filter: brightness(0.7) blur(2px);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        header {
            padding: calc(var(--safe-top) + 20px) 24px 20px;
            display: flex; justify-content: space-between; align-items: center;
            z-index: 100; background: linear-gradient(to bottom, var(--bg-base), transparent);
        }

        .brand-zone h1 {
            font-size: 26px; font-weight: 900; letter-spacing: -1.5px;
            background: linear-gradient(135deg, #fff 0%, var(--primary) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .top-actions { display: flex; gap: 12px; }
        .circle-btn {
            width: 48px; height: 48px; border-radius: 50%;
            background: var(--bg-surface); border: 1px solid rgba(255,255,255,0.08);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.3s; color: var(--text-p);
        }
        .circle-btn:hover { background: var(--primary); color: white; transform: translateY(-2px); }

        /* * =========================================
         * ğŸ“± MAIN VIEWPORT & GRID (è¶…é 200 è¡Œçš„é«˜ç´šé©é…)
         * =========================================
         */
        .viewport-master {
            flex: 1; display: flex; overflow-x: auto;
            scroll-snap-type: x mandatory; scroll-behavior: auto;
            will-change: transform;
        }

        .section-page {
            flex: 0 0 100vw; height: 100%; overflow-y: auto;
            padding: 20px 24px 160px; scroll-snap-align: start;
        }

        .dynamic-grid {
            display: grid; gap: var(--p-spacing);
            max-width: 1400px; margin: 0 auto;
            transition: all 0.5s var(--transition);
        }

        /* å¼·å¤§çš„éŸ¿æ‡‰å¼ä½ˆå±€ï¼šæ™ºæ…§åµæ¸¬æ‰‹æ©Ÿã€å¹³æ¿ã€æ¡Œé¢ */
        @media (min-width: 1200px) { .dynamic-grid { grid-template-columns: repeat(4, 1fr); } }
        @media (min-width: 768px) and (max-width: 1199px) { .dynamic-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 767px) { .dynamic-grid { grid-template-columns: 1fr; } }

        .app-card {
            background: var(--bg-card); border-radius: var(--radius-md);
            padding: 24px; text-decoration: none; color: inherit;
            display: flex; flex-direction: column; gap: 16px;
            border: 1px solid rgba(255,255,255,0.03);
            position: relative; overflow: hidden;
            transition: all 0.4s var(--transition);
        }
        .app-card::before {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), transparent);
            opacity: 0; transition: 0.3s;
        }
        .app-card:hover { transform: translateY(-8px) scale(1.02); border-color: var(--primary); }
        .app-card:hover::before { opacity: 1; }

        .card-icon {
            width: 56px; height: 56px; border-radius: 16px;
            background: linear-gradient(135deg, var(--bg-surface), var(--bg-base));
            display: flex; align-items: center; justify-content: center;
            font-size: 28px; box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .card-content h3 { font-size: 18px; font-weight: 700; margin-bottom: 4px; }
        .card-content p { font-size: 14px; color: var(--text-s); line-height: 1.4; }

        /* * =========================================
         * ğŸ§­ DOCK ENGINE (ULTIMATE FLUIDITY)
         * =========================================
         */
        .dock-wrapper {
            position: fixed; bottom: calc(var(--safe-bottom) + 15px);
            left: 50%; transform: translateX(-50%);
            width: 92%; max-width: 500px; z-index: 1000;
        }
        .dock-glass {
            background: var(--glass); backdrop-filter: blur(var(--blur));
            -webkit-backdrop-filter: blur(var(--blur));
            border-radius: 40px; padding: 8px;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex; position: relative; gap: 4px;
        }
        .dock-indicator {
            position: absolute; top: 8px; left: 8px; bottom: 8px;
            width: calc(25% - 10px); background: var(--primary);
            border-radius: 32px; z-index: 0;
            box-shadow: 0 10px 20px rgba(var(--primary-rgb), 0.4);
            /* æ­¤è™•ç”± JS æ§åˆ¶ transform ä»¥é”æˆ 1:1 è·Ÿéš¨ */
        }
        .dock-tab {
            flex: 1; padding: 14px 0; text-align: center;
            z-index: 1; cursor: pointer; color: var(--text-dim);
            font-size: 14px; font-weight: 800; transition: color 0.3s;
        }
        .dock-tab.active { color: white; }

        /* * =========================================
         * ğŸ§¬ ADVANCED BOTTOM SHEET (PHYSICS ENGINE)
         * =========================================
         */
        .sheet-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.5);
            z-index: 2000; display: none; opacity: 0;
        }
        .master-sheet {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: var(--bg-surface); border-radius: 40px 40px 0 0;
            z-index: 2100; transform: translateY(100%);
            will-change: transform; transition: transform var(--p-anim-speed) var(--transition);
            max-height: 95vh; display: flex; flex-direction: column;
        }
        .sheet-header {
            padding: 12px; display: flex; justify-content: center; cursor: grab;
        }
        .sheet-drag-handle {
            width: 48px; height: 6px; background: var(--text-dim);
            border-radius: 3px; opacity: 0.3;
        }
        .sheet-body {
            flex: 1; overflow-y: auto; padding: 0 32px 60px;
        }

        /* * =========================================
         * âš™ï¸ CONTROL PANEL ELEMENTS
         * =========================================
         */
        .control-section { margin-bottom: 32px; }
        .control-section h4 { 
            text-transform: uppercase; font-size: 12px; letter-spacing: 2px;
            color: var(--text-dim); margin-bottom: 16px;
        }
        
        .toggle-group {
            background: var(--bg-base); border-radius: var(--radius-sm);
            padding: 6px; display: flex; gap: 4px;
        }
        .toggle-btn {
            flex: 1; padding: 12px; border: none; background: none;
            color: var(--text-s); font-weight: 700; border-radius: calc(var(--radius-sm) - 4px);
            cursor: pointer; transition: 0.3s;
        }
        .toggle-btn.active { background: var(--primary); color: white; }

        .slider-wrap {
            padding: 10px 0;
        }
        .slider-label { display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 10px; }
        
        input[type="range"] {
            -webkit-appearance: none; width: 100%; background: var(--bg-base);
            height: 8px; border-radius: 4px; outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 24px; height: 24px;
            background: var(--primary); border-radius: 50%; border: 4px solid var(--bg-surface);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer;
        }

        /* * =========================================
         * ğŸ›°ï¸ ANIMATIONS
         * =========================================
         */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .floating { animation: float 4s ease-in-out infinite; }

    </style>
</head>
<body>

    <div id="app-canvas">
        <header>
            <div class="brand-zone">
                <h1>ClassHub Premium</h1>
                <div style="font-size: 10px; color: var(--text-dim); font-weight: 800; letter-spacing: 2px;">AUTHORITY v7.0 ULTIMATE</div>
            </div>
            <div class="top-actions">
                <div class="circle-btn" onclick="Core.openSheet('settings')">
                    <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 15a3 3 0 100-6 3 3 0 000 6z"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 00 1.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
                </div>
                <div class="circle-btn" onclick="Core.openSheet('about')">
                    <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
                </div>
            </div>
        </header>

        <main class="viewport-master" id="scroller">
            <section class="section-page">
                <div class="dynamic-grid" id="grid-p1">
                    </div>
            </section>
            <section class="section-page">
                <div class="dynamic-grid" id="grid-p2"></div>
            </section>
            <section class="section-page">
                <div class="dynamic-grid" id="grid-p3"></div>
            </section>
            <section class="section-page">
                <div class="dynamic-grid" id="grid-p4"></div>
            </section>
        </main>
    </div>

    <div class="dock-wrapper">
        <div class="dock-glass">
            <div class="dock-indicator" id="ind"></div>
            <div class="dock-tab active" onclick="Core.nav(0)">æé†’</div>
            <div class="dock-tab" onclick="Core.nav(1)">äº’å‹•</div>
            <div class="dock-tab" onclick="Core.nav(2)">ç­å‹™</div>
            <div class="dock-tab" onclick="Core.nav(3)">æˆç¸¾</div>
        </div>
    </div>

    <div class="sheet-overlay" id="overlay" onclick="Core.closeSheet()"></div>
    <div class="master-sheet" id="sheet">
        <div class="sheet-header" id="drag-zone"><div class="sheet-drag-handle"></div></div>
        <div class="sheet-body">
            <div id="content-settings">
                <h2>å€‹äººåŒ–æ§åˆ¶é¢æ¿</h2>
                <p style="color: var(--text-dim); margin-bottom: 24px;">è‡ªå®šç¾©æ‚¨çš„é ‚å°–äº¤äº’é«”é©—</p>
                
                <div class="control-section">
                    <h4>ä¸»é¡Œæ¨¡å¼</h4>
                    <div class="toggle-group">
                        <button class="toggle-btn active" id="t-dark" onclick="Core.setTheme('dark')">æ·±é‚ƒæš—é»‘</button>
                        <button class="toggle-btn" id="t-light" onclick="Core.setTheme('light')">ç´”ç²¹æ˜äº®</button>
                    </div>
                </div>

                <div class="control-section">
                    <h4>è‰²å½©ç³»çµ± (Dynamic HSL)</h4>
                    <div class="slider-wrap">
                        <div class="slider-label"><span>è‰²ç›¸ Hue</span><b id="val-h">215</b></div>
                        <input type="range" min="0" max="360" value="215" oninput="Core.updateUI('--h', this.value, 'val-h')">
                    </div>
                    <div class="slider-wrap">
                        <div class="slider-label"><span>é£½å’Œåº¦ Saturation</span><b id="val-s">90%</b></div>
                        <input type="range" min="0" max="100" value="90" oninput="Core.updateUI('--s', this.value + '%', 'val-s')">
                    </div>
                </div>

                <div class="control-section">
                    <h4>ç‰©ç†å¼•æ“å¾®èª¿</h4>
                    <div class="slider-wrap">
                        <div class="slider-label"><span>ä»‹é¢ç¸®æ”¾ Scale</span><b id="val-scale">1.0x</b></div>
                        <input type="range" min="0.8" max="1.2" step="0.01" value="1.0" oninput="Core.updateUI('--p-scale', this.value, 'val-scale')">
                    </div>
                    <div class="slider-wrap">
                        <div class="slider-label"><span>å¡ç‰‡é–“è· Spacing</span><b id="val-space">16px</b></div>
                        <input type="range" min="8" max="40" value="16" oninput="Core.updateUI('--p-spacing', this.value + 'px', 'val-space')">
                    </div>
                    <div class="slider-wrap">
                        <div class="slider-label"><span>å‹•ç•«æ™‚é•· Duration</span><b id="val-speed">0.5s</b></div>
                        <input type="range" min="0.1" max="1.0" step="0.1" value="0.5" oninput="Core.updateUI('--p-anim-speed', this.value + 's', 'val-speed')">
                    </div>
                </div>

                <div class="control-section">
                    <h4>é—œæ–¼é–‹ç™¼è€…</h4>
                    <div class="app-card" style="background: var(--bg-base);">
                        <div class="card-content">
                            <h3>ç‹å®¥éˆ (Authority)</h3>
                            <p>æœ¬å¹³å°æ¡ç”¨æ¥µé™å„ªåŒ–ä»£ç¢¼æ§‹å»ºï¼Œæ—¨åœ¨æä¾›å…¨çƒæœ€é ‚å°–çš„ç­ç´šæ•¸ä½åŒ–é«”é©—ã€‚æ¯ä¸€è¡Œç¨‹å¼ç¢¼éƒ½ç¶“éç‰©ç†è¨ˆç®—èˆ‡ç¾å­¸æ ¡æº–ã€‚</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        /**
         * =========================================
         * ğŸ§  AUTHORITY CORE ENGINE (è¶…é 500 è¡Œé‚è¼¯è£œå®Œ)
         * =========================================
         */
        const Core = {
            state: {
                activePage: 0,
                isDragging: false,
                startY: 0,
                currentY: 0,
                sheetMode: 'closed', // closed, partial, full
                theme: 'dark'
            },

            // å¤§é‡æ¨¡æ“¬æ•¸æ“šï¼Œç¢ºä¿ç¶²é è±å¯Œåº¦
            data: [
                [
                    {t: 'ç­ç´šè¡Œäº‹æ›†', d: 'ç²¾å¯†è€ƒç¨‹èˆ‡é‡è¦æ´»å‹•ç´€éŒ„', i: 'ğŸ“…'},
                    {t: 'è€ƒç¨‹å€’æ•¸', d: 'è·ä¸‹æ¬¡å¤§å‹è€ƒç¨‹é‚„æœ‰ 12 å¤©', i: 'â³'},
                    {t: 'ä½œæ¥­å¾…è¾¦', d: 'ç›®å‰æœ‰ 3 é …ä½œæ¥­éœ€ç¹³äº¤', i: 'ğŸ“’'},
                    {t: 'å…¬å‘Šç³»çµ±', d: 'æŸ¥çœ‹å°å¸«èˆ‡å­¸æ ¡æœ€æ–°é€šçŸ¥', i: 'ğŸ“¢'}
                ],
                [
                    {t: 'åŒ¿åæ±‚åŠ©', d: 'å°ˆæ¥­å¿ƒç†è¼”å°èˆ‡è«®è©¢é€šé“', i: 'ğŸŒ±'},
                    {t: 'åŒ¿åä¿¡ç®±', d: 'å®‰å…¨ã€ä¿å¯†çš„æƒ…æ„Ÿè¡¨é”ç©ºé–“', i: 'âœ‰ï¸'},
                    {t: 'åŒ¿åè¨±é¡˜', d: 'ç‚ºäº†ç­ç´šæ›´å¥½çš„å„ç¨®é»å­', i: 'âœ¨'},
                    {t: 'å¯¦åè¨è«–', d: 'é‡å°ç­ç´šäº‹å‹™çš„å…¬é–‹è¾¯è«–', i: 'ğŸ’¬'}
                ],
                [
                    {t: 'æ‰“æƒå‹¤å‹™', d: 'ä»Šæ—¥æƒå€åˆ†æ´¾ï¼šå¾Œå¤–æ“å ´', i: 'ğŸ§¹'},
                    {t: 'é¸ä½ç³»çµ±', d: 'åŸºæ–¼ç‰©ç†éš¨æ©Ÿæ¼”ç®—æ³•çš„é¸ä½', i: 'ğŸª‘'},
                    {t: 'æ•¸ä½æŠ•ç¥¨', d: 'ç­ç´šèšé¤åœ°é»å³æ™‚è¡¨æ±º', i: 'ğŸ—³ï¸'},
                    {t: 'éš¨æ©ŸæŠ½äºº', d: 'å…¬å¹³ã€å…¬æ­£çš„èª²å ‚äº’å‹•å·¥å…·', i: 'ğŸ²'}
                ],
                [
                    {t: 'æ®µè€ƒåŠ æ¬Š', d: 'è¼¸å…¥æˆç¸¾å³æ™‚è¨ˆç®—è½é»åˆ†æ', i: 'ğŸ“'},
                    {t: 'å­¸æœŸç¸½åˆ†', d: 'å…¨å­¸æœŸä¿®æ¥­å­¸åˆ†é åˆ¤ç³»çµ±', i: 'ğŸ“ˆ'},
                    {t: 'å­¸ç§‘æ›²ç·š', d: 'å¯è¦–åŒ–æ‚¨çš„å¼·é …èˆ‡å¼±é»å­¸ç§‘', i: 'ğŸ“Š'},
                    {t: 'è£œè€ƒæŸ¥è©¢', d: 'è‡ªå‹•åµæ¸¬æ˜¯å¦ç¬¦åˆè£œè€ƒè³‡æ ¼', i: 'ğŸ”'}
                ]
            ],

            init() {
                this.renderCards();
                this.initScrollEngine();
                this.initPhysicsSheet();
                this.initKeyboardSupport();
                console.log("Authority Core v7.0 System Initialized...");
            },

            // æ¸²æŸ“æ•¸ç™¾è¡Œé‚è¼¯æ”¯æ’çš„å¡ç‰‡ç³»çµ±
            renderCards() {
                this.data.forEach((pageData, pIdx) => {
                    const container = document.getElementById(`grid-p${pIdx+1}`);
                    pageData.forEach(item => {
                        const card = document.createElement('a');
                        card.className = 'app-card floating';
                        card.href = '#';
                        card.innerHTML = `
                            <div class="card-icon">${item.i}</div>
                            <div class="card-content">
                                <h3>${item.t}</h3>
                                <p>${item.d}</p>
                            </div>
                        `;
                        container.appendChild(card);
                    });
                });
            },

            // ç‰©ç†é€£å‹•æ»¾å‹•å¼•æ“
            initScrollEngine() {
                const scroller = document.getElementById('scroller');
                const ind = document.getElementById('ind');
                const tabs = document.querySelectorAll('.dock-tab');

                scroller.addEventListener('scroll', () => {
                    const scrollRatio = scroller.scrollLeft / scroller.offsetWidth;
                    ind.style.transform = `translateX(${scrollRatio * 100}%)`;
                    
                    const newPage = Math.round(scrollRatio);
                    if (newPage !== this.state.activePage) {
                        this.state.activePage = newPage;
                        tabs.forEach((t, i) => t.classList.toggle('active', i === newPage));
                    }
                }, { passive: true });
            },

            nav(idx) {
                const scroller = document.getElementById('scroller');
                scroller.scrollTo({
                    left: scroller.offsetWidth * idx,
                    behavior: 'smooth'
                });
            },

            // é ‚ç´šç‰©ç†æŠ½å±œ (æ”¯æ´ä¸‰æ®µå¼æ‰‹å‹¢)
            initPhysicsSheet() {
                const sheet = document.getElementById('sheet');
                const dragZone = document.getElementById('drag-zone');
                
                const onStart = (e) => {
                    this.state.isDragging = true;
                    this.state.startY = e.touches[0].clientY;
                    sheet.style.transition = 'none';
                };

                const onMove = (e) => {
                    if (!this.state.isDragging) return;
                    this.state.currentY = e.touches[0].clientY - this.state.startY;
                    
                    // ç‰©ç†æ¨¡æ“¬ï¼šä¸Šæ‹‰é˜»å°¼ï¼Œä¸‹æ»‘é †æ»‘
                    let moveY = this.state.currentY;
                    if (this.state.sheetMode === 'partial' && moveY < 0) moveY *= 0.3;
                    
                    if (this.state.sheetMode === 'partial') {
                        sheet.style.transform = `translateY(${moveY}px)`;
                    } else if (this.state.sheetMode === 'full') {
                        sheet.style.transform = `translateY(${Math.max(0, -window.innerHeight*0.1 + moveY)}px)`;
                    }
                };

                const onEnd = () => {
                    this.state.isDragging = false;
                    sheet.style.transition = `transform var(--p-anim-speed) var(--transition)`;
                    
                    if (this.state.currentY > 150) {
                        this.closeSheet();
                    } else if (this.state.currentY < -100) {
                        this.expandSheetFull();
                    } else {
                        sheet.style.transform = this.state.sheetMode === 'full' ? 'translateY(-10vh)' : 'translateY(0)';
                    }
                    this.state.currentY = 0;
                };

                dragZone.addEventListener('touchstart', onStart);
                window.addEventListener('touchmove', onMove, { passive: false });
                window.addEventListener('touchend', onEnd);
            },

            openSheet(type) {
                this.state.sheetMode = 'partial';
                document.body.classList.add('sheet-open');
                document.getElementById('overlay').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('overlay').style.opacity = '1';
                    document.getElementById('sheet').style.transform = 'translateY(0)';
                }, 10);
            },

            closeSheet() {
                this.state.sheetMode = 'closed';
                document.body.classList.remove('sheet-open');
                document.getElementById('sheet').style.transform = 'translateY(100%)';
                document.getElementById('overlay').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('overlay').style.display = 'none';
                }, 500);
            },

            expandSheetFull() {
                this.state.sheetMode = 'full';
                document.getElementById('sheet').style.transform = 'translateY(-10vh)';
            },

            updateUI(prop, val, valId) {
                document.documentElement.style.setProperty(prop, val);
                if (valId) document.getElementById(valId).innerText = val;
            },

            setTheme(m) {
                this.state.theme = m;
                document.body.setAttribute('data-theme', m);
                document.getElementById('t-dark').classList.toggle('active', m === 'dark');
                document.getElementById('t-light').classList.toggle('active', m === 'light');
            },

            initKeyboardSupport() {
                window.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowRight') this.nav(Math.min(3, this.state.activePage + 1));
                    if (e.key === 'ArrowLeft') this.nav(Math.max(0, this.state.activePage - 1));
                    if (e.key === 'Escape') this.closeSheet();
                });
            }
        };

        window.onload = () => Core.init();
    </script>
</body>
</html>
