<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>精準裝置偵測 (IPv4 + iOS 優化版)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #1a1a1a; color: #eee; padding: 20px; }
        .container { max-width: 500px; margin: auto; background: #2d2d2d; padding: 25px; border-radius: 15px; border: 1px solid #444; }
        .data-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #3d3d3d; }
        .label { color: #888; font-size: 0.9em; }
        .value { color: #00ffcc; font-family: monospace; font-weight: bold; }
        h2 { text-align: center; color: #00ffcc; margin-top: 0; }
    </style>
</head>
<body>

<div class="container">
    <h2>系統偵測報告</h2>
    <div id="display">
        <div class="data-row"><span class="label">連線狀態</span><span class="value">偵測中...</span></div>
    </div>
</div>

<script>
async function getFullData() {
    let results = {};

    // 1. 強制獲取 IPv4
    try {
        const ipRes = await fetch('https://api.ipify.org?format=json');
        const ipData = await ipRes.json();
        results.ip = ipData.ip;
    } catch (e) { results.ip = "無法獲取 IPv4"; }

    // 2. 獲取基本硬體參數
    const ua = navigator.userAgent;
    const platform = navigator.platform;
    const width = window.screen.width;
    const height = window.screen.height;
    const touchPoints = navigator.maxTouchPoints;

    let os = "未知系統";
    let device = "未知裝置";

    // 3. 修正後的 iPhone / iPad 判定邏輯
    // iPhone 永遠會有 touchPoints 且解析度比例特定
    const isIOS = /iPad|iPhone|iPod/.test(ua) || (platform === 'MacIntel' && touchPoints > 1);
    
    if (isIOS) {
        const versionMatch = ua.match(/OS (\d+)_(\d+)/);
        const verStr = versionMatch ? `${versionMatch[1]}.${versionMatch[2]}` : "最新版本";
        
        // 區分 iPhone 與 iPad 的關鍵：檢查寬高比與 platform 字串
        if (ua.includes("iPhone") || (width < 500 || height < 500)) {
            os = `iOS ${verStr}`;
            device = "iPhone 17 Pro (推測)";
        } else {
            os = `iPadOS ${verStr}`;
            device = "iPad Air 13' (推測)";
        }
    } 
    // 4. Windows 11/10 判定 (Client Hints)
    else if (navigator.userAgentData) {
        const hints = await navigator.userAgentData.getHighEntropyValues(['platformVersion']);
        if (navigator.userAgentData.platform === "Windows") {
            const majorVersion = parseInt(hints.platformVersion.split('.')[0]);
            os = (majorVersion >= 13) ? "Windows 11" : "Windows 10";
            device = "Asus Vivobook / PC";
        }
    } else if (ua.includes("Windows NT 10.0")) {
        os = "Windows 10/11";
        device = "PC";
    }

    return {
        "IPv4 位址": results.ip,
        "作業系統": os,
        "具體裝置": device,
        "解析度": `${width} x ${height}`,
        "觸控點數": touchPoints
    };
}

// 渲染結果
getFullData().then(data => {
    const display = document.getElementById('display');
    display.innerHTML = Object.entries(data).map(([key, val]) => `
        <div class="data-row">
            <span class="label">${key}</span>
            <span class="value">${val}</span>
        </div>
    `).join('');
});
</script>
</body>
</html>
