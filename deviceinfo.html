<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高級裝置偵測系統</title>
    <style>
        body { font-family: sans-serif; line-height: 1.6; padding: 20px; background: #f4f4f9; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 600px; margin: auto; }
        h2 { color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        .item { margin: 10px 0; display: flex; justify-content: space-between; }
        .label { font-weight: bold; color: #555; }
        .value { color: #007bff; text-align: right; }
        small { color: #999; word-break: break-all; }
    </style>
</head>
<body>

<div class="card">
    <h2>裝置詳細資訊報告</h2>
    <div id="report">
        <div class="item"><span class="label">正在檢測...</span></div>
    </div>
    <hr>
    <small id="ua-string"></small>
</div>

<script>
async function getIP() {
    try {
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        return `${data.ip} (${data.city}, ${data.country_code})`;
    } catch (e) { return "無法取得 IP"; }
}

function getGPU() {
    const canvas = document.createElement('canvas');
    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
    if (!gl) return "未知 GPU";
    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
    return debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_ID) : "未知 GPU";
}

async function detectDevice() {
    const ua = navigator.userAgent;
    const gpu = getGPU();
    const width = window.screen.width;
    const height = window.screen.height;
    
    let os = "未知系統";
    let model = "通用裝置";

    // 1. 偵測 Windows 10 vs 11
    if (navigator.userAgentData) {
        const hints = await navigator.userAgentData.getHighEntropyValues(['platformVersion', 'model']);
        if (navigator.userAgentData.platform === "Windows") {
            const majorVersion = parseInt(hints.platformVersion.split('.')[0]);
            os = (majorVersion >= 13) ? "Windows 11" : "Windows 10";
            model = "PC / Laptop";
        }
    } else if (ua.includes("Windows NT 10.0")) {
        os = "Windows (可能是 10 或 11)";
    }

    // 2. 偵測 iOS 與版本 (如 iOS 26.1)
    const iosMatch = ua.match(/OS (\d+)_(\d+)/);
    if (ua.includes("iPhone")) {
        os = iosMatch ? `iOS ${iosMatch[1]}.${iosMatch[2]}` : "iOS";
        // 3. 推測 iPhone 17 Pro (根據解析度與 GPU)
        // 註：iPhone 17 Pro 預期解析度會接近 393x852 或 430x932 (Points)
        if (gpu.includes("Apple") && (width === 430 || height === 932)) {
            model = "iPhone 17 Pro Max 級別裝置";
        } else {
            model = "iPhone";
        }
    }

    // 4. 偵測 iPad Air 13"
    if (ua.includes("iPad") || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)) {
        os = iosMatch ? `iPadOS ${iosMatch[1]}.${iosMatch[2]}` : "iPadOS";
        if (width >= 1024) model = "iPad Air 13' / Pro 級別";
    }

    // 5. 偵測 macOS / MacBook
    if (ua.includes("Macintosh") && navigator.maxTouchPoints === 0) {
        os = "macOS";
        model = (width <= 1440) ? "MacBook Air 13'" : "MacBook / iMac";
    }

    return {
        ip: await getIP(),
        os: os,
        model: model,
        gpu: gpu,
        res: `${width} x ${height}`,
        ua: ua
    };
}

// 渲染到網頁
detectDevice().then(data => {
    const report = document.getElementById('report');
    document.getElementById('ua-string').innerText = data.ua;
    
    const html = `
        <div class="item"><span class="label">公網 IP:</span><span class="value">${data.ip}</span></div>
        <div class="item"><span class="label">作業系統:</span><span class="value">${data.os}</span></div>
        <div class="item"><span class="label">推測型號:</span><span class="value">${data.model}</span></div>
        <div class="item"><span class="label">顯示晶片:</span><span class="value">${data.gpu}</span></div>
        <div class="item"><span class="label">螢幕解析度:</span><span class="value">${data.res}</span></div>
    `;
    report.innerHTML = html;
});
</script>

</body>
</html>
