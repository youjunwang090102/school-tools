<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ç­ç´šæ•¸ä½å¹³å° v3.1.0(bata)</title>

    <meta name="theme-color" id="chrome-theme" content="#f8fafc">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" id="safari-theme" content="default">

    <script>
        /**
         * ğŸ å•Ÿå‹•å‰ç½®é‚è¼¯ (Pre-render Execution)
         * æ­¤æ®µè…³æœ¬å¿…é ˆæ”¾åœ¨ head æœ€å‰æ–¹ï¼Œç¢ºä¿åœ¨ DOM æ§‹é€ å‰å®Œæˆç‹€æ…‹é–å®šã€‚
         */
        (function() {
            // è®€å–ä¸»é¡Œèˆ‡ä½ˆå±€å¿«å–
            const theme = localStorage.getItem('theme') || 'light';
            const layout = localStorage.getItem('layout') || 'list-mode';
            const lastPage = localStorage.getItem('lastPage') || '0';

            // ç«‹å³å¯«å…¥ HTML Class é¿å…æ¸²æŸ“é–ƒçˆ
            if (theme === 'dark') document.documentElement.classList.add('dark-mode');
            document.documentElement.setAttribute('data-layout', layout);
            document.documentElement.setAttribute('data-init-page', lastPage);
            
            // å»ºç«‹ CSS å±éšœï¼Œé˜²æ­¢åº§æ¨™è·³å‹•éç¨‹è¢«ä½¿ç”¨è€…çœ‹è¦‹
            const gateStyle = document.createElement('style');
            gateStyle.innerHTML = `
                body { opacity: 0; }
                [data-system-ready="true"] body { opacity: 1; transition: opacity 0.3s ease; }
            `;
            document.head.appendChild(gateStyle);
        })();

        // ğŸ—ï¸ å…¨åŸŸé–‹ç™¼è€…è³‡è¨Šé…ç½®
        const SYS_CONFIG = {
            banner: "è¨±é¡˜æ± ç³»çµ±è² è¼‰è¼ƒé«˜ï¼Œè«‹ç¯€çœé »ç‡ä»¥ç¶­æŒå…¶ä»–æœå‹™æ­£å¸¸ã€‚",
            author: {
                name: "ç‹å®¥éˆ",
                role: "é–‹ç™¼è€… ï½œ Developer",
                ver: "v3.1.0(bata)",
                docUrl: "#",
                updates: [
                    "- å¼·åŒ–æ·±è‰²æ¨¡å¼æŒ‰éˆ•é«˜å°æ¯”é¡¯ç¤ºï¼Œå„ªåŒ–ä½¿ç”¨é«”é©—ã€‚",
                    "- ä¿®æ­£é‡æ–°æ•´ç†å¾Œ Page Index åç§»å•é¡Œã€‚",
                    "- å¢åŠ ä¸‹æ–¹é¸å–®ï¼Œæ–¹ä¾¿åˆ‡æ›æœå‹™é …ç›®é¡åˆ¥ã€‚",
                    "- æœ€ä½³åŒ– SVG å‘é‡æ¸²æŸ“è·¯å¾‘ï¼Œä»¥å…è¡Œå‹•è£ç½®ç‰ˆåœ–ç¤ºé¡¯ç¤ºç•°å¸¸ã€‚",
                    "- æ”¯æ´æ»‘å‹•é é¢åŠŸèƒ½ï¼Œå„ªåŒ–ç”¨æˆ¶é«”é©—",
                    "- å¢åŠ åœ–ç¤ºè§¸æ§é¢ç©ï¼Œå°è§¸æ§ä½¿ç”¨è€…è¼ƒç‚ºå‹å–„ã€‚",
                    "âœ¨ [å…¨æ–°] æ”¯æ´å¡ç‰‡æ‹–æ›³è‡ªè¨‚æ’åºï¼Œä¸¦è‡ªå‹•è¨˜æ†¶æ’åˆ—çµæœã€‚",
                    "âœ¨ [å…¨æ–°] åŠ å…¥æ»‘é¼  3D æ‡¸æµ®å…‰å½±èˆ‡é»æ“Šè§¸è¦ºéœ‡å‹•åé¥‹ (Haptics)ã€‚"
                ]
            }
        };
    </script>

    <style>
        /* =============================================
           ğŸ¨ 1. è®Šæ•¸èˆ‡åŸºç¤æ ¸å¿ƒç³»çµ±
           ============================================= */
        :root {
            --p: #4361ee; 
            --p-light: rgba(67, 97, 238, 0.1);
            --g: #7209b7; 
            --bg: #f8fafc; 
            --card: #ffffff;
            --text: #1e293b; 
            --sub: #64748b; 
            --border: rgba(0,0,0,0.08);
            --nav-bg: rgba(255, 255, 255, 0.85); 
            --banner-bg: #fff9db; 
            --banner-text: #856404;
            --accent: #4361ee; /* é¸ä¸­æ™‚çš„é®®è‰·è‰² */
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }

        .dark-mode {
            --bg: #020617; 
            --card: #111827; 
            --text: #f8fafc;
            --sub: #94a3b8; 
            --border: rgba(255,255,255,0.1);
            --nav-bg: rgba(15, 23, 42, 0.85); 
            --banner-bg: #1e1b0a; 
            --banner-text: #ffe066;
            --accent: #fbbf24; /* æ·±è‰²æ¨¡å¼ä¸‹é¸ä¸­æ”¹ç‚ºç¥ç€é‡‘ï¼Œæ¥µé«˜å°æ¯” */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0; width: 100vw; height: 100dvh;
            background-color: var(--bg); color: var(--text);
            font-family: 'PingFang TC', 'Microsoft JhengHei', system-ui, sans-serif;
            overflow: hidden; position: fixed;
        }

        /* =============================================
           ğŸ“¢ 2. å…¬å‘Šæ¬„èˆ‡é ‚éƒ¨å°è¦½
           ============================================= */
        .top-notice {
            background: var(--banner-bg); color: var(--banner-text);
            padding: 9px 15px; font-size: 13px; text-align: center;
            font-weight: 700; border-bottom: 1px solid var(--border);
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        header {
            height: 72px; padding: 0 20px;
            background: var(--nav-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
            position: relative; z-index: 1000;
        }

        .brand h1 { margin: 0; font-size: 20px; font-weight: 900; color: var(--p); letter-spacing: -0.5px; }
        .brand p { margin: 0; font-size: 10px; color: var(--sub); font-weight: 800; letter-spacing: 1.2px; text-transform: uppercase; }

        /* --- ğŸ•¹ï¸ åˆ‡æ›é–‹é—œï¼šå¼·åŒ–é®®è‰·å°æ¯”å€ --- */
        .controls { display: flex; gap: 12px; align-items: center; }
        
        .toggle-group {
            display: flex; background: rgba(0,0,0,0.08); 
            padding: 4px; border-radius: 14px; gap: 4px;
            border: 1px solid var(--border);
        }
        .dark-mode .toggle-group { background: rgba(255,255,255,0.06); }

        .icon-btn {
            border: none; background: transparent; cursor: pointer;
            width: 40px; height: 34px; border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            color: var(--sub); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .icon-btn.active {
            background: var(--p); 
            color: #ffffff !important;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.4);
            transform: scale(1.05);
        }

        .dark-mode .icon-btn.active {
            background: var(--accent); /* ä½¿ç”¨ç¥ç€é‡‘ */
            color: #000000 !important; /* æ–‡å­—è½‰é»‘é”æˆæ¥µè‡´å°æ¯” */
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.3);
        }

        .circle-tool {
            width: 42px; height: 42px; border-radius: 50%;
            background: var(--card); border: 1px solid var(--border);
            color: var(--text); box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            display: flex; align-items: center; justify-content: center;
        }

        svg { width: 20px; height: 20px; fill: none; stroke: currentColor; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }

        /* =============================================
           ğŸ“– 3. ä¸»å…§å®¹æ»‘å‹•å®¹å™¨
           ============================================= */
        .viewport {
            width: 100%; height: calc(100dvh - 72px - 40px);
            display: flex; overflow-x: auto; overflow-y: hidden;
            scroll-snap-type: x mandatory; scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
        }
        .viewport::-webkit-scrollbar { display: none; }

        .page-panel {
            flex: 0 0 100%; width: 100%; height: 100%;
            scroll-snap-align: start; overflow-y: auto;
            padding: 25px 20px 180px; box-sizing: border-box;
        }

        /* ç¶²æ ¼æ ¸å¿ƒä½ˆå±€ */
        .content-grid {
            display: grid; gap: 18px; width: 100%; max-width: 1100px; margin: 0 auto;
            min-height: 100px; /* çµ¦äºˆæ‹–æ›³æ™‚çš„åŸºæœ¬é«˜åº¦ */
        }

        /* --- åˆ—è¡¨æ¨¡å¼ (List) --- */
        [data-layout="list-mode"] .content-grid { grid-template-columns: 1fr; }
        @media (min-width: 768px) { [data-layout="list-mode"] .content-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (min-width: 1200px) { [data-layout="list-mode"] .content-grid { grid-template-columns: repeat(3, 1fr); } }

        /* --- æ–¹å¡Šæ¨¡å¼ (Grid) --- */
        [data-layout="grid-mode"] .content-grid { grid-template-columns: repeat(3, 1fr); gap: 12px; }
        @media (min-width: 1024px) { [data-layout="grid-mode"] .content-grid { grid-template-columns: repeat(6, 1fr); } }

        /* âœ¨ å‡ç´šï¼šå¡ç‰‡è¨­è¨ˆåŠ å¼· (åŠ å…¥ 3D Hover & å…‰å½± & æ‹–æ›³ç‹€æ…‹) */
        .card {
            background: var(--card); border: 1px solid var(--border);
            border-radius: 24px; text-decoration: none; color: inherit;
            display: flex; position: relative;
            
            /* æ–°å¢ï¼š3D Hover åŸºç¤è¨­å®š */
            overflow: hidden;
            transform: perspective(1000px) rotateX(var(--rx, 0deg)) rotateY(var(--ry, 0deg)) scale3d(var(--scale, 1), var(--scale, 1), 1);
            transition: transform 0.15s ease-out, background 0.3s ease, box-shadow 0.3s ease, opacity 0.2s;
            will-change: transform;
            cursor: grab; /* æç¤ºå¯æ‹–æ›³ */
            
            /* æ‰‹æ©Ÿç‰ˆå„ªåŒ–ï¼šé˜²æ­¢åŸç”Ÿé¸æ“‡èˆ‡åç™½ï¼Œå¢å¼·æ‹–æ›³é«”é©— */
            user-select: none; -webkit-user-select: none; -webkit-touch-callout: none;
        }
        
        .card:active { 
            --scale: 0.96; background: var(--p-light); cursor: grabbing; 
        }

        /* æ‹–æ›³ä¸­çš„è¦–è¦ºæ•ˆæœ */
        .card.dragging {
            opacity: 0.3;
            transform: scale3d(0.92, 0.92, 1);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
            z-index: 50;
        }

        /* æ»‘é¼ è·Ÿéš¨çš„å‹•æ…‹å…‰å½± (Spotlight) */
        .card::after {
            content: ""; position: absolute; inset: 0;
            background: radial-gradient(350px circle at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(67, 97, 238, 0.08), transparent 40%);
            opacity: 0; transition: opacity 0.4s ease; pointer-events: none; z-index: 10;
        }
        .dark-mode .card::after {
            background: radial-gradient(350px circle at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(255, 255, 255, 0.1), transparent 40%);
        }
        /* åƒ…åœ¨éè§¸æ§è£ç½®ä¸Šå•Ÿç”¨ hover å…‰å½±ï¼Œé¿å…æ‰‹æ©Ÿç«¯é»æ“Šæ®˜ç•™ */
        @media (hover: hover) and (pointer: fine) {
            .card:hover::after { opacity: 1; }
        }

        [data-layout="list-mode"] .card { padding: 22px; align-items: center; }
        [data-layout="grid-mode"] .card { flex-direction: column; padding: 20px 10px; text-align: center; aspect-ratio: 1 / 1.1; justify-content: center; }

        .card-icon {
            display: flex; align-items: center; justify-content: center;
            background: var(--p-light); color: var(--p); transition: 0.3s;
        }
        [data-layout="list-mode"] .card-icon { width: 56px; height: 56px; border-radius: 16px; margin-right: 20px; font-size: 24px; }
        [data-layout="grid-mode"] .card-icon { width: 48px; height: 48px; border-radius: 50%; margin: 0 auto 12px; font-size: 22px; }

        .card-info h2 { margin: 0; font-size: 16px; font-weight: 800; color: var(--text); }
        .card-info p { margin: 5px 0 0; font-size: 12px; color: var(--sub); font-weight: 500; }
        [data-layout="grid-mode"] .card-info p { display: none; }

        /* =============================================
           ğŸ§­ 4. åº•éƒ¨å›ºæ…‹å°è¦½
           ============================================= */
        .nav-dock {
            position: fixed; bottom: calc(25px + var(--safe-bottom));
            left: 50%; transform: translateX(-50%);
            width: 92%; max-width: 440px; z-index: 5000;
        }
        .nav-glass {
            background: var(--nav-bg); backdrop-filter: blur(25px) saturate(160%);
            -webkit-backdrop-filter: blur(25px) saturate(160%);
            display: flex; padding: 6px; border-radius: 100px;
            border: 1px solid var(--border); box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }
        .nav-item {
            flex: 1; text-align: center; padding: 14px 0; font-size: 14px;
            font-weight: 900; color: var(--sub); cursor: pointer;
            border-radius: 100px; transition: 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .nav-item.active {
            color: #ffffff; background: var(--p);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
        }

        /* =============================================
           ğŸ–ï¸ 5. æ——è‰¦ç´šè³‡è¨Šå½ˆçª— (Information Modal)
           ============================================= */
        .overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            z-index: 9999; display: none; align-items: center; justify-content: center; padding: 25px;
        }
        .overlay.active { display: flex; }

        .modal {
            background: var(--bg); width: 100%; max-width: 360px;
            border-radius: 35px; overflow: hidden; border: 1px solid var(--border);
            animation: modalPop 0.4s cubic-bezier(0.17, 0.89, 0.32, 1.28);
        }
        @keyframes modalPop { from { opacity: 0; transform: scale(0.9) translateY(40px); } to { opacity: 1; transform: scale(1) translateY(0); } }

        .modal-header {
            background: linear-gradient(135deg, var(--p), var(--g));
            color: white; padding: 40px 25px; text-align: center;
        }
        .avatar {
            width: 70px; height: 70px; background: rgba(255,255,255,0.2);
            border: 3px solid #ffffff; border-radius: 50%; margin: 0 auto 15px;
            display: flex; align-items: center; justify-content: center;
            font-size: 30px; font-weight: 900;
        }

        .modal-content { padding: 30px; }
        .info-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .version-tag { background: var(--p); color: white; padding: 6px 14px; border-radius: 12px; font-size: 12px; font-weight: 800; }
        .guide-link { color: var(--p); text-decoration: none; font-size: 14px; font-weight: 900; border-bottom: 2px solid var(--p); }

        .changelog {
            background: rgba(0,0,0,0.04); border: 1px solid var(--border);
            border-radius: 20px; padding: 20px; height: 160px;
            overflow-y: auto; font-size: 13px; line-height: 1.8; color: var(--sub);
        }
        .dark-mode .changelog { background: rgba(255,255,255,0.03); }

        .close-btn {
            width: 100%; padding: 18px; background: var(--text); color: var(--bg);
            border: none; border-radius: 22px; font-weight: 900; margin-top: 25px;
            cursor: pointer; transition: 0.2s;
        }
        .close-btn:active { transform: scale(0.96); }

    </style>
</head>
<body data-layout="list-mode">

    <div class="top-notice" id="ui-banner"></div>

    <header>
        <div class="brand">
            <h1>ç­ç´šæ•¸ä½å¹³å°</h1>
            <p>Digital Classroom System</p>
        </div>
        <div class="controls">
            <div class="toggle-group">
                <button class="icon-btn" id="listToggle" onclick="updateLayout('list-mode')">
                    <svg viewBox="0 0 24 24"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><path d="M3 6h.01M3 12h.01M3 18h.01"/></svg>
                </button>
                <button class="icon-btn" id="gridToggle" onclick="updateLayout('grid-mode')">
                    <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
                </button>
            </div>
            <button class="icon-btn circle-tool" onclick="updateTheme()">
                <svg id="theme-icon" viewBox="0 0 24 24"></svg>
            </button>
            <button class="icon-btn circle-tool" onclick="showInfo(true)">
                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
            </button>
        </div>
    </header>

    <main class="viewport" id="scroll-engine">
        <section class="page-panel" id="panel-0"><div class="content-grid">
            <a href="è¡Œäº‹æ›†/index.html" class="card" draggable="true"><div class="card-icon">ğŸ“…</div><div class="card-info"><h2>ç­ç´šè¡Œäº‹æ›†</h2><p>æŒæ¡è€ƒç¨‹èˆ‡é‡è¦æ´»å‹•ä¸æ¼æ¥</p></div></a>
            <a href="countdown/index.html" class="card" draggable="true"><div class="card-icon">â³</div><div class="card-info"><h2>è€ƒç¨‹å€’æ•¸</h2><p>å€’æ•¸æ®µè€ƒèˆ‡çµ±æ¸¬</p></div></a>
            <a href="homework/index.html" class="card" draggable="true"><div class="card-icon">ğŸ“’</div><div class="card-info"><h2>ä½œæ¥­å¾…è¾¦</h2><p>å°è€å¸«æ–°å¢ä½œæ¥­ åŒå­¸å³æ™‚æŸ¥çœ‹ä¸éºæ¼</p></div></a>
        </div></section>

        <section class="page-panel" id="panel-1"><div class="content-grid">
            <a href="help/student.html" class="card" draggable="true"><div class="card-icon">ğŸŒ±</div><div class="card-info"><h2>åŒ¿åæ±‚åŠ©</h2><p>åŒ¿åæ±‚åŠ©å°å¸«</p></div></a>
            <a href="unknownmail/index.html" class="card" draggable="true"><div class="card-icon">âœ‰ï¸</div><div class="card-info"><h2>åŒ¿åä¿¡ç®±</h2><p>åŒ¿åå‚³é€æé†’çµ¦åŒå­¸ é¿å…å°·å°¬</p></div></a>
            <a href="åŒ¿å/index.html" class="card" draggable="true"><div class="card-icon">âœ¨</div><div class="card-info"><h2>åŒ¿åè¨±é¡˜æ± </h2><p>è®“ç­ç´šè®Šå¾—æ›´ç¾å¥½çš„é»å­</p></div></a>
            <a href="board/index.html" class="card" draggable="true"><div class="card-icon">ğŸ’¬</div><div class="card-info"><h2>å¯¦åç•™è¨€æ¿</h2><p>å¯¦åç•™ä¸‹æƒ³èªªçš„è©±</p></div></a>
        </div></section>

        <section class="page-panel" id="panel-2"><div class="content-grid">
            <a href="cleaning/index.html" class="card" draggable="true"><div class="card-icon">ğŸ§¹</div><div class="card-info"><h2>æ‰“æƒå‹¤å‹™</h2><p>æŸ¥çœ‹è‡ªå·±æƒå€ã€æœªæƒç™»è¨˜é»æ•¸</p></div></a>
            <a href="seating/index.html" class="card" draggable="true"><div class="card-icon">ğŸª‘</div><div class="card-info"><h2>é¸ä½ç³»çµ±</h2><p>åˆºæ¿€çš„éš¨æ©Ÿé¸ä½ å³æ™‚ç”Ÿæˆåº§ä½è¡¨</p></div></a>
            <a href="vote/index.html" class="card" draggable="true"><div class="card-icon">ğŸ—³ï¸</div><div class="card-info"><h2>æ•¸ä½æŠ•ç¥¨</h2><p>å³æ™‚è¡¨æ±ºç­ç´šäº‹å‹™</p></div></a>
            <a href="grouping/index.html" class="card" draggable="true"><div class="card-icon">ğŸ²</div><div class="card-info"><h2>éš¨æ©Ÿåˆ†çµ„</h2><p>å…¬å¹³çš„åˆ†çµ„æ–¹å¼</p></div></a>
        </div></section>

        <section class="page-panel" id="panel-3"><div class="content-grid">
            <a href="exam_calc/index.html" class="card" draggable="true"><div class="card-icon">ğŸ“</div><div class="card-info"><h2>æ®µè€ƒåŠ æ¬Š</h2><p>è¨ˆç®—æ®µè€ƒåŠ æ¬Šå¹³å‡èˆ‡ç¸½åˆ†</p></div></a>
            <a href="final_calc/index.html" class="card" draggable="true"><div class="card-icon">ğŸ“ˆ</div><div class="card-info"><h2>å­¸æœŸç¸½åˆ†</h2><p>åˆ¤æ–·é€šéã€è£œè€ƒã€æ­»ç•¶</p></div></a>
        </div></section>
    </main>

    <nav class="nav-dock">
        <div class="nav-glass">
            <div class="nav-item" onclick="moveTo(0)">æé†’</div>
            <div class="nav-item" onclick="moveTo(1)">äº’å‹•</div>
            <div class="nav-item" onclick="moveTo(2)">ç­å‹™</div>
            <div class="nav-item" onclick="moveTo(3)">æˆç¸¾</div>
        </div>
    </nav>

    <div class="overlay" id="ui-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="avatar">ç‹</div>
                <h3 id="author-name" style="margin:0"></h3>
                <p id="author-title" style="margin:5px 0 0; font-size:12px; opacity:0.8"></p>
            </div>
            <div class="modal-content">
                <div class="info-row">
                    <span class="version-tag" id="sys-ver"></span>
                    <a href="#" class="guide-link" id="sys-doc" target="_blank">ä½¿ç”¨æ•™å­¸</a>
                </div>
                <div class="changelog" id="sys-logs"></div>
                <button class="close-btn" onclick="showInfo(false)">é—œé–‰</button>
            </div>
        </div>
    </div>

    <script>
        /**
         * ğŸ æ——è‰¦ç‰ˆæ ¸å¿ƒæ§åˆ¶å™¨ (Main Controller)
         */
        const Hub = {
            dom: {
                scroller: document.getElementById('scroll-engine'),
                tabs: document.querySelectorAll('.nav-item'),
                themeIcon: document.getElementById('theme-icon'),
                chromeMeta: document.getElementById('chrome-theme'),
                safariMeta: document.getElementById('safari-theme')
            },
            state: {
                currentIdx: parseInt(localStorage.getItem('lastPage')) || 0,
                isDark: document.documentElement.classList.contains('dark-mode'),
                layout: localStorage.getItem('layout') || 'list-mode'
            }
        };

        // âœ¨ [æ–°å¢] ç³»çµ±ç´šè§¸è¦ºéœ‡å‹•å¼•æ“ (Haptic Engine)
        function sysHaptic(pattern = 15) {
            if (navigator.vibrate) {
                try { navigator.vibrate(pattern); } catch(e) {}
            }
        }

        // ğŸŒŸ [æ ¸å¿ƒ 1] åº§æ¨™é–å®šèˆ‡ç§»å‹•
        function moveTo(idx, behavior = 'smooth') {
            sysHaptic(10); // é»æ“Šå°è¦½åˆ—è¼•å¾®éœ‡å‹•
            const width = Hub.dom.scroller.offsetWidth;
            Hub.dom.scroller.scrollTo({ left: idx * width, behavior: behavior });
            Hub.state.currentIdx = idx;
            localStorage.setItem('lastPage', idx);
            updateNavUI();
        }

        function updateNavUI() {
            Hub.dom.tabs.forEach((tab, i) => {
                tab.classList.toggle('active', i === Hub.state.currentIdx);
            });
        }

        // ğŸŒŸ [æ ¸å¿ƒ 2] æ¨¡å¼åˆ‡æ›èˆ‡é®®è‰·åº¦åŒæ­¥
        function updateLayout(mode) {
            if(Hub.state.layout !== mode) sysHaptic(15);
            document.documentElement.setAttribute('data-layout', mode);
            Hub.state.layout = mode;
            localStorage.setItem('layout', mode);
            
            document.getElementById('listToggle').classList.toggle('active', mode === 'list-mode');
            document.getElementById('gridToggle').classList.toggle('active', mode === 'grid-mode');
            forceRepaint();
            setTimeout(() => moveTo(Hub.state.currentIdx, 'auto'), 60);
        }

        // ğŸŒŸ [æ ¸å¿ƒ 3] æ·±è‰²æ¨¡å¼èˆ‡å¤–æ®¼åŒæ­¥
        function updateTheme() {
            sysHaptic(20);
            Hub.state.isDark = !Hub.state.isDark;
            document.documentElement.classList.toggle('dark-mode', Hub.state.isDark);
            localStorage.setItem('theme', Hub.state.isDark ? 'dark' : 'light');
            syncSystemUI();
            forceRepaint();
        }

        function syncSystemUI() {
            const color = Hub.state.isDark ? "#020617" : "#f8fafc";
            Hub.dom.chromeMeta.content = color;
            Hub.dom.safariMeta.content = Hub.state.isDark ? "black-translucent" : "default";
            Hub.dom.themeIcon.innerHTML = Hub.state.isDark 
                ? `<circle cx="12" cy="12" r="5" fill="currentColor"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor"/>`
                : `<path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" fill="currentColor" stroke="currentColor"/>`;
        }

        // ğŸŒŸ [æ ¸å¿ƒ 4] æš´åŠ›é‡ç¹ªæŠ€è¡“
        function forceRepaint() {
            const svgs = document.querySelectorAll('svg');
            document.body.style.display = 'none';
            document.body.offsetHeight;
            document.body.style.display = 'block';
            svgs.forEach(s => s.style.opacity = '1');
        }

        // ğŸŒŸ [æ ¸å¿ƒ 5] è³‡è¨Šè¦–çª—
        function showInfo(active) {
            sysHaptic(15);
            const overlay = document.getElementById('ui-overlay');
            if (active) {
                document.getElementById('author-name').innerText = SYS_CONFIG.author.name;
                document.getElementById('author-title').innerText = SYS_CONFIG.author.role;
                document.getElementById('sys-ver').innerText = SYS_CONFIG.author.ver;
                document.getElementById('sys-doc').href = SYS_CONFIG.author.docUrl;
                document.getElementById('sys-logs').innerHTML = SYS_CONFIG.author.updates.join('<br>');
                overlay.classList.add('active');
            } else {
                overlay.classList.remove('active');
            }
        }

        /**
         * âœ¨ [æ–°å¢æ ¸å¿ƒ 6] æ——è‰¦ç´šå¡ç‰‡æ•ˆæœï¼š3D Hoverã€å…‰å½±èˆ‡æ‹–æ›³é‡æ’ç³»çµ±
         */
        function initPremiumCardFX() {
            const cards = document.querySelectorAll('.card');
            let dragSrcEl = null;

            // 1. è®€å–å„²å­˜çš„æ’åˆ—é †åº
            const savedOrder = JSON.parse(localStorage.getItem('sysCardOrder')) || {};
            document.querySelectorAll('.content-grid').forEach((grid, index) => {
                const order = savedOrder[`grid-${index}`];
                if (order) {
                    const gridCards = Array.from(grid.querySelectorAll('.card'));
                    order.forEach(href => {
                        const card = gridCards.find(c => c.getAttribute('href') === href);
                        if (card) grid.appendChild(card); // ä¾ç…§è¨˜æ†¶é‡æ–° append ç¯€é»
                    });
                }
            });

            cards.forEach(card => {
                // --- A. æ»‘é¼  3D æ‡¸æµ®èˆ‡å…‰å½±è¨ˆç®— (Mouse Tracking) ---
                card.addEventListener('mousemove', (e) => {
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    card.style.setProperty('--mouse-x', `${x}px`);
                    card.style.setProperty('--mouse-y', `${y}px`);

                    // è¨ˆç®— 3D ç¿»è½‰è§’åº¦ (æœ€å¤§åç§» 6 åº¦)
                    const rx = ((y - rect.height / 2) / (rect.height / 2)) * -6;
                    const ry = ((x - rect.width / 2) / (rect.width / 2)) * 6;
                    card.style.setProperty('--rx', `${rx}deg`);
                    card.style.setProperty('--ry', `${ry}deg`);
                    card.style.setProperty('--scale', `1.02`); // å¾®å¹…æ”¾å¤§
                });

                card.addEventListener('mouseleave', () => {
                    card.style.setProperty('--rx', `0deg`);
                    card.style.setProperty('--ry', `0deg`);
                    card.style.setProperty('--scale', `1`);
                });

                // --- B. æ‹–æ›³é‡æ’é‚è¼¯ (Drag & Drop) ---
                card.addEventListener('dragstart', function(e) {
                    dragSrcEl = this;
                    this.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/plain', this.getAttribute('href'));
                    sysHaptic(50); // æèµ·å¡ç‰‡æ™‚è¼ƒå¼·çƒˆçš„éœ‡å‹•
                });

                card.addEventListener('dragenter', function(e) {
                    if (dragSrcEl !== this && this.classList.contains('card')) {
                        const grid = this.parentNode;
                        const srcIdx = [...grid.children].indexOf(dragSrcEl);
                        const tgtIdx = [...grid.children].indexOf(this);
                        // å‹•æ…‹å°‡è¢«æ‹–æ›³çš„å…ƒç´ æ’å…¥ç›®æ¨™ä¹‹å‰æˆ–ä¹‹å¾Œï¼Œé”æˆå³æ™‚äº¤æ›è¦–è¦º
                        if (srcIdx < tgtIdx) {
                            grid.insertBefore(dragSrcEl, this.nextSibling);
                        } else {
                            grid.insertBefore(dragSrcEl, this);
                        }
                        sysHaptic(10); // äº¤æ›ç¬é–“å¾®éœ‡å‹•
                    }
                });

                card.addEventListener('dragover', (e) => e.preventDefault()); // å…è¨±æ”¾ç½®

                card.addEventListener('drop', function(e) {
                    e.preventDefault();
                    sysHaptic([30, 50, 30]); // æˆåŠŸæ”¾ä¸‹æ™‚çš„å›é¥‹éœ‡å‹•

                    // å„²å­˜æœ€æ–°çš„æ’åˆ—é †åºåˆ° localStorage
                    const orderMap = {};
                    document.querySelectorAll('.content-grid').forEach((grid, index) => {
                        const gridCards = Array.from(grid.querySelectorAll('.card'));
                        orderMap[`grid-${index}`] = gridCards.map(c => c.getAttribute('href'));
                    });
                    localStorage.setItem('sysCardOrder', JSON.stringify(orderMap));
                });

                card.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                });
                
                // é˜»æ“‹æ‹–æ›³æ”¾é–‹ç¬é–“è§¸ç™¼è¶…é€£çµè·³è½‰
                card.addEventListener('click', (e) => {
                    if (card.classList.contains('dragging')) e.preventDefault();
                });
            });
        }

        /**
         * ğŸ ç³»çµ±æ›è¼‰
         */
        window.addEventListener('DOMContentLoaded', () => {
            document.getElementById('ui-banner').innerText = SYS_CONFIG.banner;
            
            syncSystemUI();
            updateLayout(Hub.state.layout);
            initPremiumCardFX(); // å•Ÿå‹•æ——è‰¦ç´šå¡ç‰‡æ•ˆæœ
            
            setTimeout(() => {
                moveTo(Hub.state.currentIdx, 'auto');
                document.documentElement.setAttribute('data-system-ready', 'true');
            }, 50);

            Hub.dom.scroller.addEventListener('scroll', () => {
                const newIdx = Math.round(Hub.dom.scroller.scrollLeft / Hub.dom.scroller.offsetWidth);
                if (newIdx !== Hub.state.currentIdx) {
                    Hub.state.currentIdx = newIdx;
                    localStorage.setItem('lastPage', newIdx);
                    updateNavUI();
                }
            }, { passive: true });

            window.addEventListener('resize', () => moveTo(Hub.state.currentIdx, 'auto'));
        });

        window.onload = () => moveTo(Hub.state.currentIdx, 'auto');
    </script>
</body>
</html>
