<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­ç´šå³æ™‚ç•™è¨€æ¿</title>
    <style>
        :root {
            --primary: #4361ee;
            --bg: #f0f2f5;
            --card: #ffffff;
        }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 600px; }
        h1 { color: var(--primary); text-align: center; }
        
        /* è¼¸å…¥å€æ¨£å¼ */
        .input-box { background: var(--card); padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: 100px 1fr; gap: 10px; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; }
        input:focus { border-color: var(--primary); outline: none; }
        button { grid-column: span 2; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem; }
        button:hover { opacity: 0.9; }

        /* ç•™è¨€åˆ—è¡¨æ¨£å¼ */
        #messageList { display: flex; flex-direction: column; gap: 15px; }
        .msg-card { background: var(--card); padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); position: relative; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .msg-header { display: flex; justify-content: space-between; font-size: 0.85rem; color: #666; margin-bottom: 8px; border-bottom: 1px solid #f0f0f0; padding-bottom: 5px; }
        .msg-author { font-weight: bold; color: var(--primary); }
        .msg-content { font-size: 1.05rem; color: #333; line-height: 1.5; word-break: break-all; }
        .loading { text-align: center; color: #888; margin-top: 50px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ’¬ ç­ç´šé›²ç«¯ç•™è¨€æ¿</h1>

    <div class="input-box">
        <div class="grid">
            <input type="text" id="msgAuthor" placeholder="ä½ çš„åå­—">
            <input type="text" id="msgContent" placeholder="è¼¸å…¥ç•™è¨€å…§å®¹...">
            <button onclick="sendComment()">é€å‡ºç•™è¨€</button>
        </div>
    </div>

    <div id="messageList">
        <div class="loading">æ­£åœ¨é€£ç·šè‡³é›²ç«¯è³‡æ–™åº«...</div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore-compat.js"></script>

<script>
    // ä½ çš„ Firebase è¨­å®š (å·²å¸¶å…¥ä½ æä¾›çš„è³‡æ–™)
    const firebaseConfig = {
        apiKey: "AIzaSyAS2CLfgTw9RQgVmZroj0O__N7h3M7XoP0",
        authDomain: "school-tools-6668.firebaseapp.com",
        projectId: "school-tools-6668",
        storageBucket: "school-tools-6668.firebasestorage.app",
        messagingSenderId: "436587749038",
        appId: "1:436587749038:web:7153f0699078966530d73f"
    };

    // åˆå§‹åŒ–
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // è¨˜æ†¶å§“ååŠŸèƒ½
    if (localStorage.getItem('chat_name')) {
        document.getElementById('msgAuthor').value = localStorage.getItem('chat_name');
    }

    // ç™¼ä½ˆç•™è¨€
    function sendComment() {
        const author = document.getElementById('msgAuthor').value.trim();
        const content = document.getElementById('msgContent').value.trim();

        if (!author || !content) return alert("å§“åèˆ‡å…§å®¹éƒ½è¦å¡«å¯«å–”ï¼");

        localStorage.setItem('chat_name', author); // è¨˜ä½åå­—

        db.collection("messages").add({
            author: author,
            content: content,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
            document.getElementById('msgContent').value = ""; // æ¸…ç©ºè¼¸å…¥æ¡†
        });
    }

    // å³æ™‚ç›£è½æ›´æ–°
    db.collection("messages")
        .orderBy("createdAt", "desc") // æœ€æ–°çš„åœ¨ä¸Šé¢
        .limit(100)
        .onSnapshot((snapshot) => {
            const list = document.getElementById('messageList');
            list.innerHTML = ""; 

            snapshot.forEach((doc) => {
                const data = doc.data();
                const time = data.createdAt ? new Date(data.createdAt.seconds * 1000).toLocaleString() : "å‚³é€ä¸­...";
                
                const card = document.createElement('div');
                card.className = 'msg-card';
                card.innerHTML = `
                    <div class="msg-header">
                        <span class="msg-author">ğŸ‘¤ ${data.author}</span>
                        <span>${time}</span>
                    </div>
                    <div class="msg-content">${data.content}</div>
                `;
                list.appendChild(card);
            });

            if (snapshot.empty) {
                list.innerHTML = '<div class="loading">ç›®å‰é‚„æ²’æœ‰ç•™è¨€ï¼Œå¿«ä¾†æ¶é ­é¦™ï¼</div>';
            }
        });
</script>

</body>
</html>
