<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­ç´šå‹•æ…‹ç‰†</title>
    <style>
        :root { --primary: #4361ee; --bg: #f8f9fa; --card: #ffffff; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 600px; }
        h1 { color: #333; text-align: center; cursor: pointer; user-select: none; }
        
        .input-box { background: var(--card); padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: 1fr 80px; gap: 10px; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; }
        button { background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        #messageList { display: flex; flex-direction: column; gap: 12px; }
        .msg-card { background: var(--card); padding: 15px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.04); }
        .msg-header { display: flex; justify-content: space-between; font-size: 0.8rem; color: #888; margin-bottom: 5px; }
        .msg-author { font-weight: bold; color: var(--primary); }
        
        /* ğŸ›¡ï¸ ç®¡ç†å“¡éš±è—æ¨£å¼ï¼šé è¨­çµ•å°ä¸é¡¯ç¤º */
        #adminPanel { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: #222; color: white; padding: 15px; text-align: center; z-index: 999; }
        .btn-delete { display: none; color: #ff4d4f; cursor: pointer; font-size: 0.8rem; border: 1px solid #ff4d4f; padding: 2px 5px; border-radius: 4px; }
        
        /* éš±å½¢å…¥å£ï¼šå³ä¸‹è§’å€å¡Š */
        #secretZone { position: fixed; bottom: 0; right: 0; width: 40px; height: 40px; background: transparent; z-index: 998; }
    </style>
</head>
<body>

<div class="container">
    <h1 id="titleSwitch">ğŸ’¬ ç­ç´šç•™è¨€æ¿</h1>

    <div class="input-box">
        <div class="grid">
            <input type="text" id="msgContent" placeholder="è«‹è¼¸å…¥è¨Šæ¯...">
            <button onclick="sendComment()">é€å‡º</button>
        </div>
        <div id="whoAmI" style="font-size: 0.75rem; color: #999; margin-top: 10px;"></div>
    </div>

    <div id="messageList"></div>
</div>

<div id="adminPanel">
    <span>ğŸ›¡ï¸ è€å¸«ç®¡ç†æ¨¡å¼</span>
    <button onclick="clearAllMessages()" style="background:red; color:white; border:none; margin-left:10px; padding:5px; border-radius:4px;">æ¸…ç©ºå…¨éƒ¨</button>
    <button onclick="location.reload()" style="margin-left:10px;">ç™»å‡ºç®¡ç†</button>
</div>

<div id="secretZone" onclick="triggerStep2()"></div>

<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAS2CLfgTw9RQgVmZroj0O__N7h3M7XoP0",
        authDomain: "school-tools-6668.firebaseapp.com",
        projectId: "school-tools-6668",
        storageBucket: "school-tools-6668.firebasestorage.app",
        messagingSenderId: "436587749038",
        appId: "1:436587749038:web:7153f0699078966530d73f"
    };
    const ADMIN_PASSWORD = "6668"; 

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // --- ğŸ‘¤ åå­—è¨­å®šé‚è¼¯ ---
    let myName = localStorage.getItem('chat_name');
    
    function askName() {
        let n = prompt("è«‹è¼¸å…¥æ‚¨çš„å§“åï¼ˆé€™å°‡ä½œç‚ºç•™è¨€é¡¯ç¤ºçš„åå­—ï¼‰ï¼š");
        if (n && n.trim()) {
            myName = n.trim();
            localStorage.setItem('chat_name', myName);
            updateStatus();
        } else {
            alert("å¿…é ˆè¼¸å…¥åå­—æ‰èƒ½ä½¿ç”¨å–”ï¼");
            askName();
        }
    }

    function updateStatus() {
        document.getElementById('whoAmI').innerText = "ç›®å‰ç™¼è¨€èº«åˆ†ï¼š " + myName;
    }

    if (!myName) {
        askName();
    } else {
        updateStatus();
    }

    // --- ğŸ›¡ï¸ è€å¸«éš±è—é‚è¼¯ ---
    let clickCount = 0;
    let step1Cleared = false;

    document.getElementById('titleSwitch').onclick = () => {
        clickCount++;
        if (clickCount >= 5) {
            step1Cleared = true;
            clickCount = 0;
            // åªæœ‰è€å¸«è‡ªå·±çŸ¥é“ Stage 1 éäº†
        }
    };

    function triggerStep2() {
        if (step1Cleared) {
            const pw = prompt("è«‹è¼¸å…¥è€å¸«ç®¡ç†å¯†ç¢¼ï¼š");
            if (pw === ADMIN_PASSWORD) {
                document.getElementById('adminPanel').style.display = 'block';
                // é¡¯ç¤ºæ‰€æœ‰åƒåœ¾æ¡¶
                document.querySelectorAll('.btn-delete').forEach(el => el.style.display = 'inline-block');
                step1Cleared = false;
            }
        }
    }

    // --- âœ‰ï¸ ç•™è¨€åŠŸèƒ½ ---
    function sendComment() {
        const content = document.getElementById('msgContent').value.trim();
        if (!content) return;
        db.collection("messages").add({
            author: myName,
            content: content,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
            document.getElementById('msgContent').value = "";
        });
    }

    function deleteMsg(id) {
        if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) db.collection("messages").doc(id).delete();
    }

    async function clearAllMessages() {
        if(confirm("ç¢ºå®šæ¸…ç©ºå…¨ç­ç•™è¨€ï¼Ÿ")) {
            const snap = await db.collection("messages").get();
            snap.forEach(doc => doc.ref.delete());
        }
    }

    // å³æ™‚ç›£è½
    db.collection("messages").orderBy("createdAt", "desc").onSnapshot(snap => {
        const list = document.getElementById('messageList');
        list.innerHTML = "";
        snap.forEach(doc => {
            const d = doc.data();
            const time = d.createdAt ? new Date(d.createdAt.seconds * 1000).toLocaleTimeString() : "...";
            const div = document.createElement('div');
            div.className = 'msg-card';
            div.innerHTML = `
                <div class="msg-header">
                    <span class="msg-author">ğŸ‘¤ ${d.author}</span>
                    <span>${time} <span class="btn-delete" onclick="deleteMsg('${doc.id}')">ğŸ—‘ï¸</span></span>
                </div>
                <div class="msg-content">${d.content}</div>
            `;
            list.appendChild(div);
        });
    });
</script>
</body>
</html>
