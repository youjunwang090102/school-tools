<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å­¸æœŸæˆç¸¾é ä¼°ç³»çµ± - å—å¤§é™„ä¸­è³‡è¨Šç§‘</title>
    <style>
        :root { --p: #1a73e8; --bg: #f1f3f4; --red: #d93025; --orange: #f9ab00; --green: #1e8e3e; }
        body { font-family: -apple-system, "Microsoft JhengHei", sans-serif; background: var(--bg); margin: 0; padding: 10px; font-size: 14px; }
        .container { width: 100%; max-width: 500px; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: auto; }
        
        /* åŸºæœ¬è³‡æ–™å€ */
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 15px; }
        .info-grid input, .info-grid select { padding: 6px; border: 1px solid #dadce0; border-radius: 4px; font-size: 13px; }
        .full-width { grid-column: span 2; }

        /* è¡¨æ ¼å€ */
        .row-header { display: flex; background: #f8f9fa; font-weight: bold; padding: 5px 0; border-bottom: 2px solid #eee; text-align: center; font-size: 11px; }
        .row { display: flex; padding: 4px 0; border-bottom: 1px solid #f1f1f1; align-items: center; }
        .col-name { flex: 2; }
        .col-score { flex: 1; }
        .col-w { width: 30px; }
        
        input.cell { width: 90%; padding: 4px 0; text-align: center; border: 1px solid #eee; border-radius: 3px; font-size: 13px; outline-color: var(--p); }
        .name-input { text-align: left !important; padding-left: 5px !important; width: 95% !important; background: #fafafa; }

        .btn-group { margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { padding: 10px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; }
        .btn-add { background: #e8f0fe; color: var(--p); }
        .btn-exp { background: var(--p); color: white; }

        /* å ±è¡¨å½ˆçª— */
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:1000; overflow-y: auto; flex-direction: column; padding: 20px; box-sizing: border-box; }
        .print-only { font-family: "Courier New", serif; color: #333; }
        .report-header { border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 15px; }
        .report-table { width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 13px; }
        .report-table th, .report-table td { border: 1px solid #333; padding: 6px; text-align: center; }
        
        .footer-note { font-size: 11px; color: #666; margin-top: 20px; line-height: 1.6; border-top: 1px dashed #ccc; padding-top: 10px; }
        .status-pass { color: var(--green); }
        .status-re { color: var(--orange); }
        .status-fail { color: var(--red); font-weight: bold; }

        @media print { .no-print { display: none; } .modal { position: relative; display: block; } }
    </style>
</head>
<body>

<div class="container no-print">
    <div style="text-align: center; margin-bottom: 15px;">
        <h2 style="margin:0; color:var(--p)">å­¸æœŸç¸½æˆç¸¾é ä¼°</h2>
        <small>å—å¤§é™„ä¸­è³‡è¨Šç§‘å°ˆç”¨ç‰ˆ</small>
    </div>

    <div class="info-grid">
        <input type="text" id="school" value="åœ‹ç«‹å—å¤§é™„ä¸­" class="full-width">
        <input type="text" id="year" placeholder="114å­¸å¹´åº¦">
        <select id="term">
            <option>ç¬¬1å­¸æœŸ</option>
            <option>ç¬¬2å­¸æœŸ</option>
        </select>
        <input type="text" id="class" placeholder="è³‡ä¸€ç”²">
        <input type="number" id="no" placeholder="åº§è™Ÿ">
        <input type="text" id="name" placeholder="å­¸ç”Ÿå§“å" class="full-width">
    </div>

    <div class="row-header">
        <div class="col-name">ç§‘ç›®</div>
        <div class="col-score">ä¸€ç ”</div>
        <div class="col-score">äºŒç ”</div>
        <div class="col-score">æœŸæœ«</div>
        <div class="col-score">å¹³æ™‚</div>
        <div class="col-w">å­¸åˆ†</div>
    </div>

    <div id="list-container"></div>

    <div class="btn-group">
        <button class="btn btn-add" onclick="addRow()">+ å¢åŠ ç§‘ç›®</button>
        <button class="btn btn-exp" onclick="generateReport()">ğŸ–¨ï¸ ç”Ÿæˆçµç®—å ±è¡¨</button>
    </div>
</div>

<div id="report-modal" class="modal">
    <div class="print-only">
        <div class="report-header">
            <div style="float: right; font-size: 10px;" id="print-time"></div>
            <h2 id="rpt-school" style="margin:0"></h2>
            <div id="rpt-info" style="margin-top:5px"></div>
        </div>

        <table class="report-table">
            <thead>
                <tr><th>ç§‘ç›®</th><th>å­¸åˆ†</th><th>ç¸½åˆ†</th><th>åˆ¤å®šçµæœ</th></tr>
            </thead>
            <tbody id="rpt-body"></tbody>
        </table>

        <div style="display: flex; justify-content: space-between;">
            <div>æ‡‰ä¿®å­¸åˆ†ï¼š<span id="rpt-total-w"></span></div>
            <div>å¯¦å¾—å­¸åˆ†ï¼š<span id="rpt-get-w"></span></div>
            <div style="font-weight: bold;">åŠ æ¬Šå¹³å‡ï¼š<span id="rpt-avg"></span></div>
        </div>

        <div class="footer-note">
            â€» æœ¬å ±è¡¨ç‚ºå­¸ç”Ÿè‡ªè¡Œæ“ä½œåˆ—å°ï¼Œéæ­£å¼å®˜æ–¹æˆç¸¾å–®ã€‚<br>
            â€» æ¶‰åŠä¸Šä¸‹å­¸æœŸå­¸åˆ†å¹³å‡åˆ¶ï¼ˆå­¸å¹´å­¸åˆ†åˆ¶ï¼‰ï¼Œæ­¤çµæœåƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›å­¸åˆ†å–å¾—ä¾è¨»å†Šçµ„å…¬å‘Šç‚ºæº–ã€‚<br>
            <strong>ç¶²ç«™é–‹ç™¼è¨­è¨ˆè€…ï¼šå®¥éˆ (Yujun)</strong> | <span id="site-url">https://scores.yujun.tw</span>
        </div>

        <div class="no-print" style="margin-top: 30px;">
            <button class="btn btn-exp" style="width:100%" onclick="window.print()">ç«‹å³åˆ—å° / å¦å­˜ PDF</button>
            <button class="btn btn-add" style="width:100%; margin-top:10px;" onclick="document.getElementById('report-modal').style.display='none'">è¿”å›ä¿®æ”¹</button>
        </div>
    </div>
</div>

<script>
    // å—å¤§é™„ä¸­è³‡è¨Šç§‘é è¨­ç§‘ç›® (è³‡è¨Šç§‘é«˜ä¸€ç¯„ä¾‹)
    const infoTechSubjects = [
        {n:"åœ‹æ–‡", w:3}, {n:"è‹±æ–‡", w:3}, {n:"æ•¸å­¸", w:3},
        {n:"åŸºæœ¬é›»å­¸", w:3}, {n:"é›»å­å­¸", w:3}, {n:"ç¨‹å¼è¨­è¨ˆ", w:3},
        {n:"è¨ˆç®—æ©Ÿæ¦‚è«–", w:2}, {n:"ç‰©ç†", w:2}, {n:"é«”è‚²", w:2}
    ];

    function addRow(n='', w=2) {
        const div = document.createElement('div');
        div.className = 'row';
        div.innerHTML = `
            <div class="col-name"><input type="text" class="cell name-input" value="${n}"></div>
            <div class="col-score"><input type="number" class="cell s1" placeholder="0"></div>
            <div class="col-score"><input type="number" class="cell s2" placeholder="0"></div>
            <div class="col-score"><input type="number" class="cell s3" placeholder="0"></div>
            <div class="col-score"><input type="number" class="cell s4" placeholder="0"></div>
            <div class="col-w"><input type="number" class="cell w" value="${w}"></div>
        `;
        document.getElementById('list-container').appendChild(div);
    }

    function generateReport() {
        const now = new Date();
        document.getElementById('print-time').innerText = "åˆ—å°æ™‚é–“ï¼š" + now.toLocaleString();
        document.getElementById('rpt-school').innerText = document.getElementById('school').value;
        document.getElementById('rpt-info').innerText = `${document.getElementById('year').value} ${document.getElementById('term').value} | ${document.getElementById('class').value} | åº§è™Ÿï¼š${document.getElementById('no').value} | å§“åï¼š${document.getElementById('name').value}`;

        let html = '', totalW = 0, getW = 0, weightedSum = 0;

        document.querySelectorAll('#list-container .row').forEach(row => {
            const n = row.querySelector('.name-input').value;
            const s1 = parseFloat(row.querySelector('.s1').value) || 0;
            const s2 = parseFloat(row.querySelector('.s2').value) || 0;
            const s3 = parseFloat(row.querySelector('.s3').value) || 0;
            const s4 = parseFloat(row.querySelector('.s4').value) || 0;
            const w = parseFloat(row.querySelector('.w').value) || 0;

            // è¨ˆç®—å…¬å¼ 20%, 20%, 20%, 40%
            const final = Math.round(s1*0.2 + s2*0.2 + s3*0.2 + s4*0.4);
            
            let status = '', statusClass = '';
            if (final >= 60) {
                status = 'Pass';
                statusClass = 'status-pass';
                getW += w;
            } else if (final >= 40) {
                status = 'è«‹åƒåŠ è£œè€ƒ';
                statusClass = 'status-re';
            } else {
                status = 'æ­»ç•¶';
                statusClass = 'status-fail';
            }

            totalW += w;
            weightedSum += (final * w);

            html += `<tr>
                <td>${n}</td>
                <td>${w}</td>
                <td>${final}</td>
                <td class="${statusClass}">${status}</td>
            </tr>`;
        });

        document.getElementById('rpt-body').innerHTML = html;
        document.getElementById('rpt-total-w').innerText = totalW;
        document.getElementById('rpt-get-w').innerText = getW;
        document.getElementById('rpt-avg').innerText = totalW > 0 ? (weightedSum / totalW).toFixed(2) : "0.00";
        
        document.getElementById('report-modal').style.display = 'flex';
    }

    window.onload = () => {
        infoTechSubjects.forEach(s => addRow(s.n, s.w));
    };
</script>
</body>
</html>
